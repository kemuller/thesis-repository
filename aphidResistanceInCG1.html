<html>

<head>
<style type="text/css">.knitr.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}, 
.warning {
	font-weight: bold;
} 
.message {
	font-style: italic;
} 
.source, .output, .warning, .error, .message {
	padding: 0em 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f7f7f7;
}
.rimage.left {
  text-align: left;
}
.rimage.right {
  text-align: right;
}
.rimage.center {
  text-align: center;
}

.source {
  color: #333333;
}
.background {
  color: #F7F7F7;
}

.number {
  color: #000000;
}

.functioncall {
  color: #800054;
  font-weight: bolder;
}

.string {
  color: #9999FF;
}

.keyword {
  font-weight: bolder;
  color: black;
}

.argument {
  color: #B04005;
}

.comment {
  color: #2E9957;
}

.roxygencomment {
  color: #707AB3;
}

.formalargs {
  color: #B04005;
}

.eqformalargs {
  color: #B04005;
}

.assignement {
  font-weight: bolder;
  color: #000000;
}

.package {
  color: #96B525;
}

.slot {
  font-style: italic;
}

.symbol {
  color: #000000;
}

.prompt {
  color: #333333;
}
</style>
<title>Range of data collection dates, 2004-2012</title>
</head>

<body>

<p>This table shows the number of plants assessed on each date in the 1996-1998 experiments</p>

<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="functioncall">load</span>(<span class="string">"C:\\Users\\Katherine\\Dropbox\\KMullerdatasets\\cg12004-2012.RData"</span>)  #<span class="keyword">for</span> use on my computer, when I'm disconnected from the internet
# <span class="functioncall">load</span>(<span class="functioncall">url</span>(<span class="string">'http://dl.dropbox.com/s/e8xg6k2cqvalnhj/cg12004-2012.RData'</span>))

lookAtYear &lt;- <span class="functioncall"><span class="keyword">function</span></span>(x) {
    <span class="functioncall">tapply</span>(pp[pp$measureYr == x, <span class="string">"measureDt2"</span>], <span class="functioncall">list</span>(pp[pp$measureYr == x, <span class="string">"measureDt2"</span>], 
        pp[pp$measureYr == x, <span class="string">"expNm"</span>]), length)
}

yrs &lt;- <span class="functioncall">c</span>(2004:2012)
<span class="functioncall">tapply</span>(yrs, yrs, lookAtYear)
</pre></div><div class="output"><pre class="knitr r">## $`2004`
##            1996 1997 1998 1999
## 2004-08-03   NA   NA   NA  217
## 2004-08-04   NA   NA   NA  584
## 2004-08-05   NA   NA   NA   76
## 2004-08-06   42   NA   45   NA
## 2004-08-07  195  183  119    6
## 2004-08-08  236  209  117   NA
## 2004-08-09  166  163   88   NA
## 2004-08-10   NA   21   NA   NA
## 2004-08-11   NA   NA   NA    3
## 2004-08-12    6   15    5   NA
## 2004-08-31    1   NA    1   NA
## 
## $`2005`
##            1996 1997 1998 1999
## 2005-07-28   NA   NA   NA  504
## 2005-07-29   NA   NA   NA  360
## 2005-07-30   NA   NA   NA   16
## 2005-08-01   NA   NA   99   NA
## 2005-08-02   NA   NA   NA    6
## 2005-08-11  161  117   NA   NA
## 2005-08-12  160  142    6   NA
## 2005-08-14  125  163   NA   NA
## 2005-08-15   12   18   NA   NA
## 2005-08-17  151  116   NA   NA
## 2005-08-19   37   30   NA   NA
## 2005-08-29   NA    5    1   NA
## 2006-10-04   NA   NA  269   NA
## 
## $`2006`
##            1996 1997 1998 1999
## 2006-07-13   70   NA    1   NA
## 2006-07-14   41   47   NA   NA
## 2006-07-16  100   78   NA   NA
## 2006-07-17  198  200   NA   NA
## 2006-07-18  144  100   NA   NA
## 2006-07-19   81  103   NA   NA
## 2006-07-20    2   33   93   NA
## 2006-07-21   NA   NA   NA  868
## 2006-07-22   NA   NA   NA    1
## 2006-08-03    6   27    4   10
## 2006-08-04    3   NA   NA    2
## 2006-08-05    1    3    2    5
## 
## $`2007`
##            1996 1997 1998 1999
## 2007-07-19  111   74   75   NA
## 2007-07-20  188  158  104   NA
## 2007-07-22   25   24   15   NA
## 2007-07-23  254  237  150   NA
## 2007-07-24   13   14   30   52
## 2007-07-25   55   72   NA  413
## 2007-07-26   NA   NA   NA   34
## 2007-07-27   NA    9   NA  349
## 2007-07-31   NA   NA   NA   35
## 2007-08-08   NA    3    1    3
## 
## $`2008`
##            1996 1997 1998 1999
## 2008-07-23   12    1   NA    5
## 2008-07-29   NA   NA   NA   32
## 2008-07-30   NA   NA   NA  529
## 2008-08-01   NA   NA   NA  236
## 2008-08-07   29   NA   40   NA
## 2008-08-08   96   55   44   NA
## 2008-08-10   23   31   NA   NA
## 2008-08-12   47   52   13   NA
## 2008-08-13  101   45   70   NA
## 2008-08-14   84   76   45   10
## 2008-08-15    6   40   NA   NA
## 2008-08-16   23   43   14   NA
## 2008-08-19  225  248  149   NA
## 2008-08-22   NA   NA   NA   74
## 
## $`2009`
##            1996 1997 1998 1999
## 2009-07-24    1   NA   NA   NA
## 2009-07-29   NA   NA   NA  327
## 2009-07-30   NA   NA   NA  551
## 2009-07-31  381  311  220   NA
## 2009-08-03  257  272  150   NA
## 2009-08-05    7    8    5    8
## 
## $`2010`
##            1996 1997 1998 1999
## 2010-07-14  307  188  177   NA
## 2010-07-15  329  365  195  357
## 2010-07-16    4   24   NA  519
## 2010-07-18   NA   NA   NA    1
## 2010-07-27    6   14    3    9
## 
## $`2011`
##            1996 1997 1998 1999
## 2011-07-22  286  244  179   NA
## 2011-07-25  354  308  195   31
## 2011-07-26    4   24   NA  853
## 2011-08-02   NA   NA    1   NA
## 2011-08-09   NA   13   NA   NA
## 2011-08-12   NA    1   NA   NA
## 2011-08-16    2    1   NA    2
## 
## $`2012`
##            1996 1997 1998 1999
## 2012-07-06  447  385  333   NA
## 2012-07-10  194  200   41  336
## 2012-07-11   NA   NA    1  540
## 2012-07-23    2    1   NA   NA
## 2012-07-27    1    3   NA   NA
## 2012-07-30    1   NA   NA    6
## 2012-07-31    1    1   NA    1
## 2012-08-01   NA    1   NA    3
</pre></div></div></div>


<p>There is a possibility that the measure dates reflect can't finds that were added later.</p>

<div class="chunk" id="unnamed-chunk-2"><div class="rcode"><div class="source"><pre class="knitr r">lookAtYear &lt;- <span class="functioncall"><span class="keyword">function</span></span>(x, y) {
    <span class="functioncall">tapply</span>(pp[pp$measureYr == x &amp; pp$expNm == y, <span class="string">"measureDt2"</span>], <span class="functioncall">list</span>(pp[pp$measureYr == 
        x &amp; pp$expNm == y, <span class="string">"measureDt2"</span>], pp[pp$measureYr == x &amp; pp$expNm == 
        y, <span class="string">"Status"</span>]), length)
}

<span class="functioncall">lookAtYear</span>(2004, 1996)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2004-08-06     9        19        14
## 2004-08-07    57        67        71
## 2004-08-08    68        80        88
## 2004-08-09    47        56        63
## 2004-08-12     4         2        NA
## 2004-08-31    NA         1        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2005, 1996)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2005-08-11    75        45        41
## 2005-08-12    61        62        37
## 2005-08-14    56        47        22
## 2005-08-15    NA        12        NA
## 2005-08-17    54        60        37
## 2005-08-19    24         4         9
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2006, 1996)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2006-07-13    17        33        20
## 2006-07-14    18        14         9
## 2006-07-16    32        35        33
## 2006-07-17    57        71        70
## 2006-07-18    42        61        41
## 2006-07-19    22        25        34
## 2006-07-20    NA        NA         2
## 2006-08-03    NA         6        NA
## 2006-08-04     3        NA        NA
## 2006-08-05     1        NA        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2007, 1996)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2007-07-19    32        40        39
## 2007-07-20    51        74        63
## 2007-07-22     7        12         6
## 2007-07-23    69       107        78
## 2007-07-24     4         5         4
## 2007-07-25     9        12        34
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2008, 1996)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2008-07-23     9         1         2
## 2008-08-07     5        19         5
## 2008-08-08    34        36        26
## 2008-08-10     7         7         9
## 2008-08-12    15        23         9
## 2008-08-13    22        50        29
## 2008-08-14    28        36        20
## 2008-08-15     5         1        NA
## 2008-08-16     7        13         3
## 2008-08-19    65        98        62
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2009, 1996)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2009-07-24    NA        NA         1
## 2009-07-31   111       167       103
## 2009-08-03    55       129        73
## 2009-08-05     1         6        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2010, 1996)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2010-07-14   109       140        58
## 2010-07-15   103       161        65
## 2010-07-16     4        NA        NA
## 2010-07-27     4         2        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2011, 1996)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2011-07-22    56       139        91
## 2011-07-25    67       170       117
## 2011-07-26    NA         2         2
## 2011-08-16     2        NA        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2012, 1996)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2012-07-06   102       270        75
## 2012-07-10    94        41        59
## 2012-07-23    NA         2        NA
## 2012-07-27     1        NA        NA
## 2012-07-30     1        NA        NA
## 2012-07-31     1        NA        NA
</pre></div><div class="source"><pre class="knitr r">

<span class="functioncall">lookAtYear</span>(2004, 1997)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2004-08-07    84        62        37
## 2004-08-08   100        73        36
## 2004-08-09    68        45        50
## 2004-08-10     9         9         3
## 2004-08-12    11         4        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2005, 1997)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2005-08-11    70        40         7
## 2005-08-12    87        51         4
## 2005-08-14    88        69         6
## 2005-08-15    NA        18        NA
## 2005-08-17    71        39         6
## 2005-08-19    24         2         4
## 2005-08-29     5        NA        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2006, 1997)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2006-07-14    15        25         7
## 2006-07-16    45        15        18
## 2006-07-17    98        71        31
## 2006-07-18    46        33        21
## 2006-07-19    48        41        14
## 2006-07-20    17        10         6
## 2006-08-03     1        26        NA
## 2006-08-05     2         1        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2007, 1997)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2007-07-19    32        37         5
## 2007-07-20    83        57        18
## 2007-07-22    10        14        NA
## 2007-07-23   140        75        22
## 2007-07-24     6         6         2
## 2007-07-25    26        38         8
## 2007-07-27     8         1        NA
## 2007-08-08     3        NA        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2008, 1997)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2008-07-23     1        NA        NA
## 2008-08-08    24        25         6
## 2008-08-10    16        12         3
## 2008-08-12    28        19         5
## 2008-08-13    16        22         7
## 2008-08-14    35        27        14
## 2008-08-15    15        18         7
## 2008-08-16    15        19         9
## 2008-08-19    98       122        28
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2009, 1997)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2009-07-31   132       151        28
## 2009-08-03   109       122        41
## 2009-08-05     3         5        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2010, 1997)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2010-07-14    81        85        22
## 2010-07-15   160       182        23
## 2010-07-16     7        14         3
## 2010-07-27    10         4        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2011, 1997)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2011-07-22    60       133        51
## 2011-07-25    93       142        73
## 2011-07-26     7        15         2
## 2011-08-09     7         4         2
## 2011-08-12     1        NA        NA
## 2011-08-16     1        NA        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2012, 1997)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2012-07-06   109       254        22
## 2012-07-10   135        40        25
## 2012-07-23    NA         1        NA
## 2012-07-27     2         1        NA
## 2012-07-31     1        NA        NA
## 2012-08-01     1        NA        NA
</pre></div><div class="source"><pre class="knitr r">

<span class="functioncall">lookAtYear</span>(2004, 1998)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2004-08-06     5        38         2
## 2004-08-07    27        92        NA
## 2004-08-08    28        85         4
## 2004-08-09    16        72        NA
## 2004-08-12     5        NA        NA
## 2004-08-31    NA         1        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2005, 1998)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2005-08-01    75        16         8
## 2005-08-12    NA         6        NA
## 2005-08-29     1        NA        NA
## 2006-10-04    NA       269        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2006, 1998)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2006-07-13    NA        NA         1
## 2006-07-20    57        17        19
## 2006-08-03    NA         4        NA
## 2006-08-05     1         1        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2007, 1998)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2007-07-19    12        63        NA
## 2007-07-20    18        80         6
## 2007-07-22     2        12         1
## 2007-07-23    26       120         4
## 2007-07-24     7        23        NA
## 2007-08-08     1        NA        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2008, 1998)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2008-08-07     4        32         4
## 2008-08-08     2        41         1
## 2008-08-12    NA        13        NA
## 2008-08-13    11        58         1
## 2008-08-14     4        39         2
## 2008-08-16    NA        13         1
## 2008-08-19    20       120         9
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2009, 1998)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2009-07-31    28       184         8
## 2009-08-03    20       126         4
## 2009-08-05    NA         5        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2010, 1998)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2010-07-14    25       148         4
## 2010-07-15    25       165         5
## 2010-07-27    NA         3        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2011, 1998)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2011-07-22    15       152        12
## 2011-07-25    15       171         9
## 2011-08-02    NA         1        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2012, 1998)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2012-07-06    20       311         2
## 2012-07-10    22        17         2
## 2012-07-11     1        NA        NA
</pre></div><div class="source"><pre class="knitr r">

<span class="functioncall">lookAtYear</span>(2004, 1999)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2004-08-03   164        47         6
## 2004-08-04   449       115        20
## 2004-08-05    59        15         2
## 2004-08-07     6        NA        NA
## 2004-08-11     3        NA        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2005, 1999)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2005-07-28   371       123        10
## 2005-07-29   281        74         5
## 2005-07-30    13         3        NA
## 2005-08-02     3         3        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2006, 1999)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2006-07-21   524       229       115
## 2006-07-22     1        NA        NA
## 2006-08-03     5         5        NA
## 2006-08-04     1         1        NA
## 2006-08-05     5        NA        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2007, 1999)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2007-07-24    23        20         9
## 2007-07-25   230       142        41
## 2007-07-26    25         5         4
## 2007-07-27   213        75        61
## 2007-07-31    20         6         9
## 2007-08-08     3        NA        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2008, 1999)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2008-07-23     3        NA         2
## 2008-07-29    16        13         3
## 2008-07-30   230       183       116
## 2008-08-01   119        69        48
## 2008-08-14     3         7        NA
## 2008-08-22    35        15        24
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2009, 1999)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2009-07-29   157       118        52
## 2009-07-30   273       175       103
## 2009-08-05     3         5        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2010, 1999)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2010-07-15   179       130        48
## 2010-07-16   266       170        83
## 2010-07-18    NA         1        NA
## 2010-07-27     5         4        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2011, 1999)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2011-07-25    13        10         8
## 2011-07-26   295       296       262
## 2011-08-16     2        NA        NA
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">lookAtYear</span>(2012, 1999)
</pre></div><div class="output"><pre class="knitr r">##            basal can'tFind flowering
## 2012-07-10   186       133        17
## 2012-07-11   304       188        48
## 2012-07-30     3         3        NA
## 2012-07-31     1        NA        NA
## 2012-08-01     2         1        NA
</pre></div></div></div>

It doesn't look like that's an issue.
<p></p>
<p>Visualize aphid abundance by site and year</p>

<div class="chunk" id="unnamed-chunk-3"><div class="rcode"><div class="source"><pre class="knitr r"><span class="comment"># switch factor levels of aphid abundance <span class="keyword">for</span> visualizing</span>
pp$aphids2 &lt;- <span class="functioncall">factor</span>(pp$aphids2, levels = <span class="functioncall">c</span>(<span class="string">"&gt;80"</span>, <span class="string">"11-80"</span>, <span class="string">"1-10"</span>, <span class="string">"0"</span>))
pp &lt;- pp[pp$Status != <span class="string">"can'tFind"</span>, ]  #only look at plants
pp96 &lt;- pp[pp$expNm == 1996 &amp; pp$siteOfOriginPedigree != <span class="string">"unknown"</span>, ]
pp97 &lt;- pp[pp$expNm == 1997 &amp; pp$siteOfOriginPedigree != <span class="string">"unknown"</span>, ]
pp98 &lt;- pp[pp$expNm == 1998 &amp; pp$siteOfOriginPedigree != <span class="string">"unknown"</span>, ]
pp99 &lt;- pp[pp$expNm == 1999 &amp; pp$siteOfOriginPedigree != <span class="string">"unknown"</span>, ]

<span class="comment"># fix site levels and order by size</span>
pp96$siteOfOriginPedigree &lt;- <span class="functioncall">factor</span>(pp96$siteOfOriginPedigree, levels = <span class="functioncall">unique</span>(pp96$siteOfOriginPedigree))
pp96$siteOfOriginPedigree &lt;- <span class="functioncall">factor</span>(pp96$siteOfOriginPedigree, levels = <span class="functioncall">dimnames</span>(<span class="functioncall">sort</span>(<span class="functioncall">table</span>(pp96$siteOfOriginPedigree)))[[1]])
pp97$siteOfOriginPedigree &lt;- <span class="functioncall">factor</span>(pp97$siteOfOriginPedigree, levels = <span class="functioncall">unique</span>(pp97$siteOfOriginPedigree))
pp97$siteOfOriginPedigree &lt;- <span class="functioncall">factor</span>(pp97$siteOfOriginPedigree, levels = <span class="functioncall">dimnames</span>(<span class="functioncall">sort</span>(<span class="functioncall">table</span>(pp97$siteOfOriginPedigree)))[[1]])
pp99$siteOfOriginPedigree &lt;- <span class="functioncall">factor</span>(pp99$siteOfOriginPedigree, levels = <span class="functioncall">unique</span>(pp99$siteOfOriginPedigree))
pp99$siteOfOriginPedigree &lt;- <span class="functioncall">factor</span>(pp99$siteOfOriginPedigree, levels = <span class="functioncall">dimnames</span>(<span class="functioncall">sort</span>(<span class="functioncall">table</span>(pp99$siteOfOriginPedigree)))[[1]])

lookAtAphids &lt;- <span class="functioncall"><span class="keyword">function</span></span>(x, y) {
    zz &lt;- <span class="functioncall">tapply</span>(x[x$measureYr == y, <span class="string">"aphids2"</span>], <span class="functioncall">list</span>(x[x$measureYr == y, <span class="string">"aphids2"</span>], 
        x[x$measureYr == y, <span class="string">"siteOfOriginPedigree"</span>]), length)
    zz[<span class="functioncall">is.na</span>(zz)] &lt;- 0
    zzt &lt;- zz
    <span class="functioncall"><span class="keyword">for</span></span> (i <span class="keyword">in</span> 1:<span class="functioncall">dim</span>(zz)[1]) {
        zzt[i, ] &lt;- zz[i, ]/<span class="functioncall">apply</span>(zz, 2, sum)
    }
    # <span class="functioncall">par</span>(xpd=T, mar=<span class="functioncall">par</span>()$mar+<span class="functioncall">c</span>(1,0,0,6)))
    cols &lt;- <span class="functioncall">gray</span>(<span class="functioncall">c</span>(<span class="functioncall">seq</span>(0, 1, by = 1/3)))
    bp &lt;- <span class="functioncall">barplot</span>(zzt, ylim = <span class="functioncall">c</span>(0, 1), col = cols)
    <span class="functioncall">text</span>(bp, 0.05, <span class="functioncall">table</span>(x[x$measureYr == y, <span class="string">"siteOfOriginPedigree"</span>]), col = <span class="string">"red"</span>)
    <span class="functioncall">legend</span>(<span class="string">"topright"</span>, legend = <span class="functioncall">levels</span>(x$aphids2), fill = cols, bty = <span class="string">"n"</span>)
    <span class="functioncall">legend</span>(<span class="string">"topleft"</span>, legend = <span class="functioncall">c</span>(<span class="functioncall">paste</span>(<span class="functioncall">unique</span>(x$expNm), <span class="string">"exp"</span>, sep = <span class="string">""</span>), y), 
        bty = <span class="string">"n"</span>)
    # <span class="functioncall">par</span>(mar=<span class="functioncall">c</span>(5,4,4,2) + 0.1)
}
</pre></div></div></div>


<b>1996 Garden, 2004-2012:</b>
<div class="chunk" id="unnamed-chunk-4"><div class="rcode"><div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp96, 2004)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-41.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp96, 2005)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-42.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp96, 2006)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-43.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp96, 2007)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-44.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp96, 2008)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-45.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp96, 2009)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-46.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp96, 2010)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-47.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp96, 2011)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-48.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp96, 2012)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-49.png" title="plot of chunk unnamed-chunk-4" alt="plot of chunk unnamed-chunk-4" class="plot" /></div></div>


<b>1997 Garden, 2004-2012:</b>
<div class="chunk" id="unnamed-chunk-5"><div class="rcode"><div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp97, 2004)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-51.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp97, 2005)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-52.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp97, 2006)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-53.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp97, 2007)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-54.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp97, 2008)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-55.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp97, 2009)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-56.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp97, 2010)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-57.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp97, 2011)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-58.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp97, 2012)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-59.png" title="plot of chunk unnamed-chunk-5" alt="plot of chunk unnamed-chunk-5" class="plot" /></div></div>


<b>1999 Garden, 2004-2012:</b>
<div class="chunk" id="unnamed-chunk-6"><div class="rcode"><div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp99, 2004)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-61.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp99, 2005)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-62.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp99, 2006)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-63.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp99, 2007)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-64.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp99, 2008)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-65.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp99, 2009)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-66.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp99, 2010)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-67.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp99, 2011)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-68.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">lookAtAphids</span>(pp99, 2012)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-69.png" title="plot of chunk unnamed-chunk-6" alt="plot of chunk unnamed-chunk-6" class="plot" /></div></div>


<b>Next step: analyze aphid abundance as a function of size, location, measure date, and population. Strategy for model selection: </b>
<p>1. Remove factors one at a time and test against larger model with an ANOVA</p>
<p>2. Remove the factor that produces the largest p-value when removed from the model. </p>
<p>3. Repeat until all factors have been removed. </p>

<p>Start with the 1996 garden in 2004</p>

<div class="chunk" id="unnamed-chunk-7"><div class="rcode"><div class="source"><pre class="knitr r"><span class="comment"># look at differences by measuredate</span>
ss &lt;- pp96[pp96$measureYr == 2004, ]
# <span class="functioncall">str</span>(ss)
<span class="functioncall">table</span>(ss$measureDt2)
</pre></div><div class="output"><pre class="knitr r">## 
## 2004-08-06 2004-08-07 2004-08-08 2004-08-09 2004-08-12 
##         17        125        126        108          3
</pre></div><div class="source"><pre class="knitr r">ss$date &lt;- <span class="functioncall">factor</span>(ss$measureDt2)
<span class="comment"># these dates are within a week of each other--leave them all <span class="keyword">in</span> for now</span>
zz &lt;- <span class="functioncall">tapply</span>(ss$aphids2, <span class="functioncall">list</span>(ss$aphids2, ss$date), length)
zz[<span class="functioncall">is.na</span>(zz)] &lt;- 0
<span class="functioncall">barplot</span>(zz)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-71.png" title="plot of chunk unnamed-chunk-7" alt="plot of chunk unnamed-chunk-7" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="comment"># no obvious difference</span>
ss$lfClass &lt;- <span class="string">""</span>
ss[ss$basalLfCt &gt;= 6, <span class="string">"lfClass"</span>] &lt;- <span class="string">"&gt;6"</span>
ss[ss$basalLfCt &lt;= 5, <span class="string">"lfClass"</span>] &lt;- <span class="string">"1-5"</span>
ss[ss$Status == <span class="string">"flowering"</span>, <span class="string">"lfClass"</span>] &lt;- <span class="string">"flowering"</span>
ss$lfClass &lt;- <span class="functioncall">factor</span>(ss$lfClass, levels = <span class="functioncall">c</span>(<span class="string">"1-5"</span>, <span class="string">"&gt;6"</span>, <span class="string">"flowering"</span>))
<span class="functioncall">table</span>(ss$lfClass, ss$siteOfOriginPedigree)  #look at distribution of plant sizes/status among pops
</pre></div><div class="output"><pre class="knitr r">##            
##             tower ness aa sap lf spp eri nwlf
##   1-5           1    6  2   7 12   7  11   21
##   >6            0    8  6  12  9  13  23   25
##   flowering     0    6 13  31 28  43  43   52
</pre></div><div class="source"><pre class="knitr r"># exclude <span class="functioncall">tower</span> (only 1 plant)
ss &lt;- ss[ss$siteOfOriginPedigree != <span class="string">"tower"</span>, ]
ss$siteOfOriginPedigree &lt;- <span class="functioncall">factor</span>(ss$siteOfOriginPedigree, levels = <span class="functioncall">unique</span>(ss$siteOfOriginPedigree))


ss$aphids2 &lt;- <span class="functioncall">ordered</span>(ss$aphids2, levels = <span class="functioncall">c</span>(<span class="string">"0"</span>, <span class="string">"1-10"</span>, <span class="string">"11-80"</span>, <span class="string">"&gt;80"</span>))

<span class="comment"># keep row and position as numeric</span>
<span class="functioncall">library</span>(MASS)
a6 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass:siteOfOriginPedigree + lfClass + siteOfOriginPedigree + 
    row + pos + date, data = ss)
a5 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + row + pos + date, data = ss)
<span class="functioncall">anova</span>(a5, a6)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                                                              Model
## 1                                lfClass + siteOfOriginPedigree + row + pos + date
## 2 lfClass:siteOfOriginPedigree + lfClass + siteOfOriginPedigree + row + pos + date
##   Resid. df Resid. Dev   Test    Df LR stat. Pr(Chi)
## 1       361      884.0                              
## 2       349      870.2 1 vs 2    12    13.76  0.3165
</pre></div><div class="source"><pre class="knitr r">a5.1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ siteOfOriginPedigree + row + pos + date, data = ss)
a5.2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + row + pos + date, data = ss)
a5.3 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + pos + date, data = ss)
a5.4 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + row + date, data = ss)
a5.5 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + row + pos, data = ss)
<span class="functioncall">anova</span>(a5.1, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1           siteOfOriginPedigree + row + pos + date       363        904
## 2 lfClass + siteOfOriginPedigree + row + pos + date       361        884
##     Test    Df LR stat.   Pr(Chi)
## 1                                
## 2 1 vs 2     2       20 4.542e-05
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.2, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1                        lfClass + row + pos + date       367      887.7
## 2 lfClass + siteOfOriginPedigree + row + pos + date       361      884.0
##     Test    Df LR stat. Pr(Chi)
## 1                              
## 2 1 vs 2     6    3.767  0.7081
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.3, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1       lfClass + siteOfOriginPedigree + pos + date       362        887
## 2 lfClass + siteOfOriginPedigree + row + pos + date       361        884
##     Test    Df LR stat. Pr(Chi)
## 1                              
## 2 1 vs 2     1    3.024 0.08205
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.4, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1       lfClass + siteOfOriginPedigree + row + date       362      884.4
## 2 lfClass + siteOfOriginPedigree + row + pos + date       361      884.0
##     Test    Df LR stat. Pr(Chi)
## 1                              
## 2 1 vs 2     1   0.4704  0.4928
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.5, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1        lfClass + siteOfOriginPedigree + row + pos       365      894.3
## 2 lfClass + siteOfOriginPedigree + row + pos + date       361      884.0
##     Test    Df LR stat. Pr(Chi)
## 1                              
## 2 1 vs 2     4    10.32 0.03536
</pre></div><div class="source"><pre class="knitr r">a4 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + row + pos + date, data = ss)
a4.1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ row + pos + date, data = ss)
a4.2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + pos + date, data = ss)
a4.3 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + row + date, data = ss)
a4.4 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + row + pos, data = ss)

<span class="functioncall">anova</span>(a4.1, a4)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                        Model Resid. df Resid. Dev   Test    Df LR stat.
## 1           row + pos + date       369      908.0                      
## 2 lfClass + row + pos + date       367      887.7 1 vs 2     2    20.22
##     Pr(Chi)
## 1          
## 2 4.064e-05
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.2, a4)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                        Model Resid. df Resid. Dev   Test    Df LR stat.
## 1       lfClass + pos + date       368      891.0                      
## 2 lfClass + row + pos + date       367      887.7 1 vs 2     1    3.314
##   Pr(Chi)
## 1        
## 2  0.0687
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.3, a4)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                        Model Resid. df Resid. Dev   Test    Df LR stat.
## 1       lfClass + row + date       368      888.2                      
## 2 lfClass + row + pos + date       367      887.7 1 vs 2     1   0.5151
##   Pr(Chi)
## 1        
## 2  0.4729
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.4, a4)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                        Model Resid. df Resid. Dev   Test    Df LR stat.
## 1        lfClass + row + pos       371      898.7                      
## 2 lfClass + row + pos + date       367      887.7 1 vs 2     4    10.99
##   Pr(Chi)
## 1        
## 2 0.02668
</pre></div><div class="source"><pre class="knitr r">
a3 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + row + date, data = ss)
a3.1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ row + date, data = ss)
a3.2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + date, data = ss)
a3.3 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + row, data = ss)
<span class="functioncall">anova</span>(a3.1, a3)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                  Model Resid. df Resid. Dev   Test    Df LR stat.
## 1           row + date       370      908.2                      
## 2 lfClass + row + date       368      888.2 1 vs 2     2    19.97
##     Pr(Chi)
## 1          
## 2 4.619e-05
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.2, a3)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                  Model Resid. df Resid. Dev   Test    Df LR stat. Pr(Chi)
## 1       lfClass + date       369      891.5                              
## 2 lfClass + row + date       368      888.2 1 vs 2     1    3.207 0.07332
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.3, a3)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                  Model Resid. df Resid. Dev   Test    Df LR stat. Pr(Chi)
## 1        lfClass + row       372      899.9                              
## 2 lfClass + row + date       368      888.2 1 vs 2     4    11.63 0.02033
</pre></div><div class="source"><pre class="knitr r">a2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + date, data = ss)
a2.1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ date, data = ss)
a2.2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass, data = ss)
<span class="functioncall">anova</span>(a2.1, a2)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##            Model Resid. df Resid. Dev   Test    Df LR stat.   Pr(Chi)
## 1           date       371      910.5                                
## 2 lfClass + date       369      891.5 1 vs 2     2    19.05 7.318e-05
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a2.2, a2)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##            Model Resid. df Resid. Dev   Test    Df LR stat. Pr(Chi)
## 1        lfClass       373      902.6                              
## 2 lfClass + date       369      891.5 1 vs 2     4    11.16 0.02478
</pre></div><div class="source"><pre class="knitr r">a1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass, data = ss)
null &lt;- <span class="functioncall">polr</span>(aphids2 ~ 1, data = ss)
<span class="functioncall">anova</span>(null, a1, a2, a3, a4, a5, a6)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                                                              Model
## 1                                                                                1
## 2                                                                          lfClass
## 3                                                                   lfClass + date
## 4                                                             lfClass + row + date
## 5                                                       lfClass + row + pos + date
## 6                                lfClass + siteOfOriginPedigree + row + pos + date
## 7 lfClass:siteOfOriginPedigree + lfClass + siteOfOriginPedigree + row + pos + date
##   Resid. df Resid. Dev   Test    Df LR stat.   Pr(Chi)
## 1       375      923.6                                
## 2       373      902.6 1 vs 2     2  20.9540 2.818e-05
## 3       369      891.5 2 vs 3     4  11.1642 2.478e-02
## 4       368      888.2 3 vs 4     1   3.2072 7.332e-02
## 5       367      887.7 4 vs 5     1   0.5151 4.729e-01
## 6       361      884.0 5 vs 6     6   3.7675 7.081e-01
## 7       349      870.2 6 vs 7    12  13.7574 3.165e-01
</pre></div><div class="source"><pre class="knitr r">
<span class="comment"># examine best model:</span>
best &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + date, data = ss)
(pb &lt;- <span class="functioncall">profile</span>(best))
</pre></div><div class="message"><pre class="knitr r">## Re-fitting to get Hessian
</pre></div><div class="output"><pre class="knitr r">## $`lfClass>6`
##          z par.vals.lfClass>6 par.vals.lfClassflowering
## 1  -2.5842             0.1073                    0.6964
## 2  -2.0667             0.2581                    0.7871
## 3  -1.5492             0.4090                    0.8776
## 4  -1.0321             0.5598                    0.9683
## 5  -0.5156             0.7106                    1.0589
## 6   0.0000             0.8614                    1.1496
## 7   0.5146             1.0123                    1.2403
## 8   1.0279             1.1631                    1.3312
## 9   1.5396             1.3139                    1.4223
## 10  2.0496             1.4648                    1.5136
## 11  2.5575             1.6156                    1.6051
## 12  3.0633             1.7664                    1.6969
##    par.vals.date2004-08-07 par.vals.date2004-08-08 par.vals.date2004-08-09
## 1                  -0.8894                 -1.1456                 -1.2695
## 2                  -0.8895                 -1.1513                 -1.2784
## 3                  -0.8900                 -1.1573                 -1.2877
## 4                  -0.8902                 -1.1633                 -1.2970
## 5                  -0.8912                 -1.1701                 -1.3072
## 6                  -0.8924                 -1.1772                 -1.3178
## 7                  -0.8941                 -1.1849                 -1.3290
## 8                  -0.8948                 -1.1918                 -1.3395
## 9                  -0.8962                 -1.1995                 -1.3509
## 10                 -0.8978                 -1.2074                 -1.3626
## 11                 -0.8995                 -1.2157                 -1.3747
## 12                 -0.9014                 -1.2242                 -1.3872
##    par.vals.date2004-08-12
## 1                  -3.2196
## 2                  -3.1811
## 3                  -3.1455
## 4                  -3.1108
## 5                  -3.0818
## 6                  -3.0556
## 7                  -3.0326
## 8                  -3.0087
## 9                  -2.9885
## 10                 -2.9706
## 11                 -2.9546
## 12                 -2.9405
## 
## $lfClassflowering
##          z par.vals.lfClass>6 par.vals.lfClassflowering
## 1  -2.5891             0.3577                    0.4669
## 2  -2.0699             0.4590                    0.6034
## 3  -1.5511             0.5599                    0.7399
## 4  -1.0330             0.6607                    0.8765
## 5  -0.5159             0.7611                    1.0130
## 6   0.0000             0.8614                    1.1496
## 7   0.5144             0.9616                    1.2861
## 8   1.0270             1.0616                    1.4227
## 9   1.5375             1.1616                    1.5592
## 10  2.0458             1.2616                    1.6957
## 11  2.5515             1.3616                    1.8323
## 12  3.0545             1.4617                    1.9688
##    par.vals.date2004-08-07 par.vals.date2004-08-08 par.vals.date2004-08-09
## 1                  -0.9463                 -1.1876                 -1.3289
## 2                  -0.9355                 -1.1851                 -1.3263
## 3                  -0.9247                 -1.1829                 -1.3238
## 4                  -0.9139                 -1.1808                 -1.3216
## 5                  -0.9029                 -1.1786                 -1.3193
## 6                  -0.8924                 -1.1772                 -1.3178
## 7                  -0.8815                 -1.1756                 -1.3161
## 8                  -0.8705                 -1.1740                 -1.3145
## 9                  -0.8595                 -1.1726                 -1.3131
## 10                 -0.8483                 -1.1712                 -1.3119
## 11                 -0.8371                 -1.1700                 -1.3108
## 12                 -0.8258                 -1.1689                 -1.3099
##    par.vals.date2004-08-12
## 1                  -3.3881
## 2                  -3.3180
## 3                  -3.2499
## 4                  -3.1834
## 5                  -3.1172
## 6                  -3.0556
## 7                  -2.9942
## 8                  -2.9337
## 9                  -2.8749
## 10                 -2.8173
## 11                 -2.7610
## 12                 -2.7057
## 
## $`date2004-08-07`
##          z par.vals.lfClass>6 par.vals.lfClassflowering
## 1  -2.9452            0.87551                   1.13607
## 2  -2.4823            0.87203                   1.13582
## 3  -2.0060            0.86885                   1.13643
## 4  -1.5178            0.86612                   1.13806
## 5  -1.0195            0.86392                   1.14078
## 6  -0.5129            0.86236                   1.14466
## 7   0.0000            0.86144                   1.14957
## 8   0.5168            0.86119                   1.15544
## 9   1.0357            0.86160                   1.16213
## 10  1.5547            0.86266                   1.16949
## 11  2.0723            0.86437                   1.17739
## 12  2.5869            0.86677                   1.18576
##    par.vals.date2004-08-07 par.vals.date2004-08-08 par.vals.date2004-08-09
## 1                 -2.53230                -2.67211                -2.81642
## 2                 -2.25899                -2.41783                -2.56160
## 3                 -1.98567                -2.16593                -2.30909
## 4                 -1.71236                -1.91622                -2.05877
## 5                 -1.43904                -1.66845                -1.81034
## 6                 -1.16573                -1.42226                -1.56350
## 7                 -0.89241                -1.17723                -1.31783
## 8                 -0.61910                -0.93293                -1.07294
## 9                 -0.34578                -0.68894                -0.82840
## 10                -0.07247                -0.44489                -0.58387
## 11                 0.20085                -0.20045                -0.33905
## 12                 0.47416                 0.04461                -0.09370
##    par.vals.date2004-08-12
## 1                 -4.57732
## 2                 -4.32000
## 3                 -4.06446
## 4                 -3.81022
## 5                 -3.55784
## 6                 -3.30585
## 7                 -3.05563
## 8                 -2.80538
## 9                 -2.55554
## 10                -2.30579
## 11                -2.05599
## 12                -1.80598
## 
## $`date2004-08-08`
##          z par.vals.lfClass>6 par.vals.lfClassflowering
## 1  -2.9418            0.89270                   1.15961
## 2  -2.4797            0.88688                   1.15617
## 3  -2.0042            0.88110                   1.15324
## 4  -1.5168            0.87554                   1.15103
## 5  -1.0190            0.87034                   1.14963
## 6  -0.5127            0.86566                   1.14918
## 7   0.0000            0.86144                   1.14957
## 8   0.5169            0.85775                   1.15076
## 9   1.0362            0.85495                   1.15291
## 10  1.5558            0.85272                   1.15567
## 11  2.0742            0.85124                   1.15906
## 12  2.5898            0.85055                   1.16304
##    par.vals.date2004-08-07 par.vals.date2004-08-08 par.vals.date2004-08-09
## 1                 -2.38572                -2.81440                -2.82044
## 2                 -2.13218                -2.54154                -2.56539
## 3                 -1.88085                -2.26868                -2.31247
## 4                 -1.63154                -1.99581                -2.06156
## 5                 -1.38395                -1.72295                -1.81237
## 6                 -1.13773                -1.45009                -1.56460
## 7                 -0.89241                -1.17723                -1.31783
## 8                 -0.64755                -0.90436                -1.07168
## 9                 -0.40281                -0.63150                -0.82581
## 10                -0.15773                -0.35864                -0.57982
## 11                 0.08796                -0.08578                -0.33345
## 12                 0.33449                 0.18708                -0.08649
##    par.vals.date2004-08-12
## 1                 -4.57454
## 2                 -4.31782
## 3                 -4.06283
## 4                 -3.80923
## 5                 -3.55722
## 6                 -3.30518
## 7                 -3.05563
## 8                 -2.80641
## 9                 -2.55570
## 10                -2.30586
## 11                -2.05594
## 12                -1.80573
## 
## $`date2004-08-09`
##          z par.vals.lfClass>6 par.vals.lfClassflowering
## 1  -2.9440            0.90244                   1.15938
## 2  -2.4811            0.89528                   1.15597
## 3  -2.0050            0.88804                   1.15308
## 4  -1.5171            0.88089                   1.15090
## 5  -1.0191            0.87399                   1.14956
## 6  -0.5127            0.86750                   1.14915
## 7   0.0000            0.86144                   1.14957
## 8   0.5169            0.85596                   1.15088
## 9   1.0363            0.85112                   1.15298
## 10  1.5562            0.84698                   1.15579
## 11  2.0750            0.84360                   1.15922
## 12  2.5913            0.84102                   1.16324
##    par.vals.date2004-08-07 par.vals.date2004-08-08 par.vals.date2004-08-09
## 1                 -2.38044                -2.67083                -2.96714
## 2                 -2.12735                -2.41678                -2.69225
## 3                 -1.87670                -2.16514                -2.41737
## 4                 -1.62825                -1.91571                -2.14248
## 5                 -1.38167                -1.66818                -1.86760
## 6                 -1.13656                -1.42218                -1.59271
## 7                 -0.89241                -1.17723                -1.31783
## 8                 -0.64876                -0.93289                -1.04295
## 9                 -0.40516                -0.68871                -0.76806
## 10                -0.16119                -0.44431                -0.49318
## 11                 0.08348                -0.19935                -0.21829
## 12                 0.32912                 0.04643                 0.05659
##    par.vals.date2004-08-12
## 1                 -4.57387
## 2                 -4.31707
## 3                 -4.06208
## 4                 -3.80860
## 5                 -3.55663
## 6                 -3.30489
## 7                 -3.05563
## 8                 -2.80584
## 9                 -2.55631
## 10                -2.30676
## 11                -2.05690
## 12                -1.80666
## 
## $`date2004-08-12`
##          z par.vals.lfClass>6 par.vals.lfClassflowering
## 1  -2.5968             0.8530                    1.1218
## 2  -2.3320             0.8530                    1.1222
## 3  -2.0406             0.8531                    1.1230
## 4  -1.7167             0.8533                    1.1244
## 5  -1.3542             0.8537                    1.1270
## 6  -0.9479             0.8547                    1.1315
## 7  -0.4957             0.8555                    1.1376
## 8   0.0000             0.8614                    1.1496
## 9   0.5315             0.8689                    1.1641
## 10  1.0880             0.8796                    1.1819
## 11  1.6564             0.8926                    1.2014
## 12  2.2234             0.9065                    1.2206
## 13  2.7764             0.9192                    1.2374
##    par.vals.date2004-08-07 par.vals.date2004-08-08 par.vals.date2004-08-09
## 1                  -1.1500                 -1.4345                 -1.5768
## 2                  -1.1456                 -1.4301                 -1.5724
## 3                  -1.1374                 -1.4219                 -1.5641
## 4                  -1.1222                 -1.4067                 -1.5488
## 5                  -1.0952                 -1.3797                 -1.5217
## 6                  -1.0507                 -1.3352                 -1.4769
## 7                  -0.9829                 -1.2675                 -1.4087
## 8                  -0.8924                 -1.1772                 -1.3178
## 9                  -0.7811                 -1.0662                 -1.2062
## 10                 -0.6578                 -0.9435                 -1.0827
## 11                 -0.5331                 -0.8194                 -0.9580
## 12                 -0.4178                 -0.7047                 -0.8428
## 13                 -0.3209                 -0.6085                 -0.7462
##    par.vals.date2004-08-12
## 1                  -7.7387
## 2                  -7.0697
## 3                  -6.4006
## 4                  -5.7316
## 5                  -5.0626
## 6                  -4.3936
## 7                  -3.7246
## 8                  -3.0556
## 9                  -2.3866
## 10                 -1.7176
## 11                 -1.0486
## 12                 -0.3796
## 13                  0.2894
## 
## attr(,"original.fit")
## Call:
## polr(formula = aphids2 ~ lfClass + date, data = ss)
## 
## Coefficients:
##        lfClass>6 lfClassflowering   date2004-08-07   date2004-08-08 
##           0.8614           1.1496          -0.8924          -1.1772 
##   date2004-08-09   date2004-08-12 
##          -1.3178          -3.0556 
## 
## Intercepts:
##     0|1-10 1-10|11-80  11-80|>80 
##     -1.818     -1.267      1.032 
## 
## Residual Deviance: 891.46 
## AIC: 909.46 
## attr(,"summary")
## Call:
## polr(formula = aphids2 ~ lfClass + date, data = ss)
## 
## Coefficients:
##                    Value Std. Error t value
## lfClass>6         0.8614     0.2928   2.942
## lfClassflowering  1.1496     0.2650   4.337
## date2004-08-07   -0.8924     0.5305  -1.682
## date2004-08-08   -1.1772     0.5297  -2.223
## date2004-08-09   -1.3178     0.5336  -2.470
## date2004-08-12   -3.0556     1.2986  -2.353
## 
## Intercepts:
##            Value   Std. Error t value
## 0|1-10     -1.8180  0.5520    -3.2931
## 1-10|11-80 -1.2668  0.5488    -2.3082
## 11-80|>80   1.0319  0.5475     1.8847
## 
## Residual Deviance: 891.46 
## AIC: 909.46 
## attr(,"class")
## [1] "profile.polr" "profile"
</pre></div><div class="source"><pre class="knitr r"><span class="comment"># I don't know what the profile tells you.</span>
<span class="functioncall">plot</span>(pb)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-72.png" title="plot of chunk unnamed-chunk-7" alt="plot of chunk unnamed-chunk-7" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="comment"># Here's my guess: I think the pairs plot tells you whether factor levels</span>
<span class="comment"># have similar variance--If the red and green lines line up, the levels</span>
<span class="comment"># have similar variance.</span>
<span class="functioncall">pairs</span>(pb)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-73.png" title="plot of chunk unnamed-chunk-7" alt="plot of chunk unnamed-chunk-7" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r">
## use goodness of fit <span class="functioncall">test</span> (<span class="keyword">if</span> p val &gt;0.05, model is a good fit)
<span class="functioncall">pchisq</span>(<span class="functioncall">deviance</span>(best), <span class="functioncall">df.residual</span>(best))
</pre></div><div class="output"><pre class="knitr r">## [1] 1
</pre></div><div class="source"><pre class="knitr r">
# compare predicted abundances to actual <span class="functioncall">abundances</span> (by size class on one
<span class="comment"># date)</span>
newd &lt;- <span class="functioncall">data.frame</span>(lfClass = <span class="functioncall">c</span>(<span class="string">"1-5"</span>, <span class="string">"&gt;6"</span>, <span class="string">"flowering"</span>), date = <span class="string">"2004-08-07"</span>)
pred &lt;- <span class="functioncall">predict</span>(best, type = <span class="string">"prob"</span>, newdata = newd)
obs &lt;- <span class="functioncall">tapply</span>(ss$lfClass, <span class="functioncall">list</span>(ss$lfClass, ss$aphids2), length)
(obs &lt;- obs/<span class="functioncall">apply</span>(obs, 1, sum))
</pre></div><div class="output"><pre class="knitr r">##                0   1-10  11-80     >80
## 1-5       0.2879 0.1818 0.4697 0.06061
## >6        0.1562 0.0625 0.6146 0.16667
## flowering 0.1667 0.0787 0.4398 0.31481
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 2))
<span class="functioncall">barplot</span>(pred, beside = T)
<span class="functioncall">legend</span>(<span class="string">"topleft"</span>, legend = <span class="string">"pred."</span>, bty = <span class="string">"n"</span>)
<span class="functioncall">barplot</span>(obs, beside = T)
<span class="functioncall">legend</span>(<span class="string">"topleft"</span>, legend = <span class="string">"obs"</span>, bty = <span class="string">"n"</span>)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-74.png" title="plot of chunk unnamed-chunk-7" alt="plot of chunk unnamed-chunk-7" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 1))

<span class="comment"># it looks pretty good.</span>
</pre></div></div></div>


<b>Next: compare results of polr with a glm binomial of aphid presence/absence (1996 garden, 2004):</b>
<div class="chunk" id="unnamed-chunk-8"><div class="rcode"><div class="source"><pre class="knitr r">ss$aphidsPresent &lt;- 0
ss[ss$aphids2 != <span class="string">"0"</span>, <span class="string">"aphidsPresent"</span>] &lt;- 1

a6 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
    lfClass + row + pos + date, family = binomial, data = ss)
# <span class="functioncall">summary</span>(a6)
a5 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + date, 
    family = binomial, data = ss)
<span class="functioncall">anova</span>(a5, a6, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
## Model 2: aphidsPresent ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
##     lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       363        350                     
## 2       351        331 12     18.4      0.1
</pre></div><div class="source"><pre class="knitr r">a5.1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ +lfClass + row + pos + date, family = binomial, 
    data = ss)
a5.2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + row + pos + date, family = binomial, 
    data = ss)
a5.3 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + lfClass + pos + date, family = binomial, 
    data = ss)
a5.4 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + lfClass + row + date, family = binomial, 
    data = ss)
a5.5 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos, family = binomial, 
    data = ss)
<span class="functioncall">anova</span>(a5.1, a5, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ +lfClass + row + pos + date
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       369        352                     
## 2       363        350  6     2.13     0.91
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.2, a5, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + row + pos + date
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       365        352                     
## 2       363        350  2     2.66     0.26
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.3, a5, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + lfClass + pos + date
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       364        350                     
## 2       363        350  1    0.397     0.53
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.4, a5, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + date
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       364        351                     
## 2       363        350  1     1.78     0.18
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.5, a5, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       367        353                     
## 2       363        350  4      3.3     0.51
</pre></div><div class="source"><pre class="knitr r">
a4 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row + pos + date, family = binomial, data = ss)
a4.1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ +row + pos + date, family = binomial, data = ss)
a4.2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + pos + date, family = binomial, data = ss)
a4.3 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row + date, family = binomial, data = ss)
a4.4 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row + pos, family = binomial, data = ss)
<span class="functioncall">anova</span>(a4.1, a4, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ +row + pos + date
## Model 2: aphidsPresent ~ lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       371        355                     
## 2       369        352  2     2.91     0.23
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.2, a4, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + pos + date
## Model 2: aphidsPresent ~ lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       370        352                     
## 2       369        352  1    0.514     0.47
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.3, a4, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + row + date
## Model 2: aphidsPresent ~ lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       370        353                     
## 2       369        352  1     1.79     0.18
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.4, a4, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + row + pos
## Model 2: aphidsPresent ~ lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       373        355                     
## 2       369        352  4     3.26     0.52
</pre></div><div class="source"><pre class="knitr r">
a3 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row + pos, family = binomial, data = ss)
a3.1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ +row + pos, family = binomial, data = ss)
a3.2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + pos, family = binomial, data = ss)
a3.3 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row, family = binomial, data = ss)
<span class="functioncall">anova</span>(a3.1, a3, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ +row + pos
## Model 2: aphidsPresent ~ lfClass + row + pos
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       375        359                     
## 2       373        355  2     3.68     0.16
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.2, a3, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + pos
## Model 2: aphidsPresent ~ lfClass + row + pos
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       374        355                     
## 2       373        355  1    0.309     0.58
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.3, a3, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + row
## Model 2: aphidsPresent ~ lfClass + row + pos
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       374        357                     
## 2       373        355  1     1.74     0.19
</pre></div><div class="source"><pre class="knitr r">
a2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + pos, family = binomial, data = ss)
a2.1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ pos, family = binomial, data = ss)
a2.2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass, family = binomial, data = ss)
<span class="functioncall">anova</span>(a2.1, a2, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ pos
## Model 2: aphidsPresent ~ lfClass + pos
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       376        359                     
## 2       374        355  2     3.49     0.17
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a2.2, a2, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass
## Model 2: aphidsPresent ~ lfClass + pos
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)
## 1       375        357                     
## 2       374        355  1     1.83     0.18
</pre></div><div class="source"><pre class="knitr r">a1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass, family = binomial, data = ss)
null &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ 1, family = binomial, data = ss)
<span class="functioncall">anova</span>(null, a1, a2, a3, a4, a5, a6, test = <span class="string">"Chi"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ 1
## Model 2: aphidsPresent ~ lfClass
## Model 3: aphidsPresent ~ lfClass + pos
## Model 4: aphidsPresent ~ lfClass + row + pos
## Model 5: aphidsPresent ~ lfClass + row + pos + date
## Model 6: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
## Model 7: aphidsPresent ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
##     lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance Pr(>Chi)  
## 1       377        362                       
## 2       375        357  2     5.16    0.076 .
## 3       374        355  1     1.84    0.176  
## 4       373        355  1     0.31    0.578  
## 5       369        352  4     3.26    0.516  
## 6       363        350  6     2.13    0.908  
## 7       351        331 12    18.39    0.104  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
<span class="comment"># evaluate best model:</span>
best &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass, family = binomial, data = ss)
<span class="functioncall">summary</span>(best)
</pre></div><div class="output"><pre class="knitr r">## 
## Call:
## glm(formula = aphidsPresent ~ lfClass, family = binomial, data = ss)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.927   0.583   0.604   0.604   0.824  
## 
## Coefficients:
##                  Estimate Std. Error z value Pr(>|z|)    
## (Intercept)         0.906      0.272    3.33  0.00086 ***
## lfClass>6           0.781      0.391    2.00  0.04589 *  
## lfClassflowering    0.704      0.327    2.15  0.03164 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
## 
## (Dispersion parameter for binomial family taken to be 1)
## 
##     Null deviance: 362.25  on 377  degrees of freedom
## Residual deviance: 357.09  on 375  degrees of freedom
## AIC: 363.1
## 
## Number of Fisher Scoring iterations: 4
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(2, 2))
<span class="functioncall">plot</span>(best)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-8.png" title="plot of chunk unnamed-chunk-8" alt="plot of chunk unnamed-chunk-8" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 1))
<span class="comment"># doesn't look great</span>
</pre></div></div></div>



How about categories of low vs. high abundance?
<div class="chunk" id="unnamed-chunk-9"><div class="rcode"><div class="source"><pre class="knitr r">ss$aphidLH &lt;- 0
ss[ss$aphids2 %<span class="keyword">in</span>% <span class="functioncall">c</span>(<span class="string">"0"</span>, <span class="string">"1-10"</span>), <span class="string">"aphidLH"</span>] &lt;- 0
ss[ss$aphids2 %<span class="keyword">in</span>% <span class="functioncall">c</span>(<span class="string">"11-80"</span>, <span class="string">"&gt;80"</span>), <span class="string">"aphidLH"</span>] &lt;- 1

a6 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + lfClass + 
    row + pos + date, family = quasibinomial, data = ss)
# <span class="functioncall">summary</span>(a6) overdispersion--use quasibinomial
a5 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date, family = quasibinomial, 
    data = ss)
<span class="functioncall">anova</span>(a5, a6, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
## Model 2: aphidLH ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
##     lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       363        417                        
## 2       351        399 12     17.6 1.46   0.14
</pre></div><div class="source"><pre class="knitr r">a5.1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ +lfClass + row + pos + date, family = quasibinomial, data = ss)
a5.2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + row + pos + date, family = quasibinomial, 
    data = ss)
a5.3 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + pos + date, family = quasibinomial, 
    data = ss)
a5.4 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + row + date, family = quasibinomial, 
    data = ss)
a5.5 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + row + pos, family = quasibinomial, 
    data = ss)
<span class="functioncall">anova</span>(a5.1, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ +lfClass + row + pos + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       369        423                        
## 2       363        417  6     5.61 0.92   0.48
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.2, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + row + pos + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance   F Pr(>F)   
## 1       365        428                          
## 2       363        417  2     11.2 5.5 0.0044 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.3, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + pos + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance  F Pr(>F)
## 1       364        419                      
## 2       363        417  1     2.05  2   0.16
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.4, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + row + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       364        417                        
## 2       363        417  1    0.368 0.36   0.55
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.5, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)  
## 1       367        425                          
## 2       363        417  4     8.11 1.99  0.096 .
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
a4 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + row + date, family = quasibinomial, 
    data = ss)
a4.1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + row + date, family = quasibinomial, data = ss)
a4.2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + row + date, family = quasibinomial, 
    data = ss)
a4.3 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + date, family = quasibinomial, 
    data = ss)
a4.4 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + row, family = quasibinomial, 
    data = ss)

<span class="functioncall">anova</span>(a4.1, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ lfClass + row + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       370        423                        
## 2       364        417  6     5.71 0.93   0.47
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.2, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + row + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)   
## 1       366        430                           
## 2       364        417  2     12.7 6.23 0.0022 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.3, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       365        419                        
## 2       364        417  1     2.09 2.05   0.15
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.4, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + row
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       368        425                        
## 2       364        417  4      7.9 1.93    0.1
</pre></div><div class="source"><pre class="knitr r">
a3 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + row + +date, family = quasibinomial, data = ss)
a3.1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ row + +date, family = quasibinomial, data = ss)
a3.2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + +date, family = quasibinomial, data = ss)
a3.3 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + row, family = quasibinomial, data = ss)

<span class="functioncall">anova</span>(a3.1, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ row + +date
## Model 2: aphidLH ~ lfClass + row + +date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)   
## 1       372        436                           
## 2       370        423  2     13.3 6.58 0.0016 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.2, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ lfClass + +date
## Model 2: aphidLH ~ lfClass + row + +date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       371        425                        
## 2       370        423  1      2.2 2.18   0.14
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.3, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ lfClass + row
## Model 2: aphidLH ~ lfClass + row + +date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       374        431                        
## 2       370        423  4     7.62 1.89   0.11
</pre></div><div class="source"><pre class="knitr r">
a2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + date, family = quasibinomial, data = ss)
a2.1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ date, family = quasibinomial, data = ss)
a2.2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass, family = quasibinomial, data = ss)
<span class="functioncall">anova</span>(a2.1, a2, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ date
## Model 2: aphidLH ~ lfClass + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)   
## 1       373        438                           
## 2       371        425  2     12.5 6.16 0.0023 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a2.2, a2, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ lfClass
## Model 2: aphidLH ~ lfClass + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       375        433                        
## 2       371        425  4     7.59 1.87   0.11
</pre></div><div class="source"><pre class="knitr r">a1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass, family = quasibinomial, data = ss)
null &lt;- <span class="functioncall">glm</span>(aphidLH ~ 1, family = quasibinomial, data = ss)
<span class="functioncall">anova</span>(null, a1, a2, a3, a4, a5, a6, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ 1
## Model 2: aphidLH ~ lfClass
## Model 3: aphidLH ~ lfClass + date
## Model 4: aphidLH ~ lfClass + row + +date
## Model 5: aphidLH ~ siteOfOriginPedigree + lfClass + row + date
## Model 6: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
## Model 7: aphidLH ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
##     lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)   
## 1       377        447                           
## 2       375        433  2    13.86 6.91 0.0011 **
## 3       371        425  4     7.59 1.90 0.1108   
## 4       370        423  1     2.20 2.20 0.1393   
## 5       364        417  6     5.71 0.95 0.4593   
## 6       363        417  1     0.37 0.37 0.5450   
## 7       351        399 12    17.55 1.46 0.1373   
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
<span class="comment"># evaluate best model:</span>
best &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass, family = quasibinomial, data = ss)
<span class="functioncall">summary</span>(best)
</pre></div><div class="output"><pre class="knitr r">## 
## Call:
## glm(formula = aphidLH ~ lfClass, family = quasibinomial, data = ss)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
##  -1.74   -1.23    0.75    0.75    1.13  
## 
## Coefficients:
##                  Estimate Std. Error t value Pr(>|t|)    
## (Intercept)         0.121      0.248    0.49  0.62434    
## lfClass>6           1.152      0.350    3.29  0.00111 ** 
## lfClassflowering    1.002      0.294    3.41  0.00073 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
## 
## (Dispersion parameter for quasibinomial family taken to be 1.008)
## 
##     Null deviance: 446.68  on 377  degrees of freedom
## Residual deviance: 432.82  on 375  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 4
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(2, 2))
<span class="functioncall">plot</span>(best)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-9.png" title="plot of chunk unnamed-chunk-9" alt="plot of chunk unnamed-chunk-9" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 1))
</pre></div></div></div>


<p><b>Summary for 1996 garden, 2004, 3 types of models:</b></p>
<p><b>1. POLR</b></p>
The best model included size/status (p=0.000028) and measure date (p=0.025). Maternal population did not contribute significantly to model variance (p=0.78). Out of the three models, the POLR seemed to be the most informative and the best fit for the data.
<p></p>
<p>2. GLM binomial of aphid presence/absence:</p>
<p> The test of aphid presence/absence did not detect differences based on date (p=0.51585) and detected a weaker effect of plant size (p=0.076). Similar to the POLR, maternal population did not matter (p=0.90757). Based on the model checking, this model may not be a good fit for the data.</p>
<p></p>
<p>3. GLM quasibinomial of low (1-10) vs high (>10) aphid abundance:</p>
 Plant size/status was the most important factor (p=0.00113), followed by date, which was not significant (p=0.111).Maternal population was not significant (p=0.459). The qualitative result is more similar to the POLR when I use high and low aphid abundance (0-10 and >10) instead of presence/absence.  
</p>
<p><b>Now try the 1997 garden in 2004</b>
</p>

<div class="chunk" id="unnamed-chunk-10"><div class="rcode"><div class="source"><pre class="knitr r"><span class="comment"># look at differences my measuredate</span>
ss &lt;- pp97[pp97$measureYr == 2004, ]
<span class="functioncall">table</span>(ss$measureDt2)
</pre></div><div class="output"><pre class="knitr r">## 
## 2004-08-07 2004-08-08 2004-08-09 2004-08-10 2004-08-12 
##        121        135        118         12         11
</pre></div><div class="source"><pre class="knitr r">ss$date &lt;- <span class="functioncall">factor</span>(ss$measureDt2)
<span class="comment"># these dates are within a week of each other--leave them all <span class="keyword">in</span> for now</span>
zz &lt;- <span class="functioncall">tapply</span>(ss$aphids2, <span class="functioncall">list</span>(ss$aphids2, ss$date), length)
zz[<span class="functioncall">is.na</span>(zz)] &lt;- 0
<span class="functioncall">barplot</span>(zz)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-101.png" title="plot of chunk unnamed-chunk-10" alt="plot of chunk unnamed-chunk-10" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="comment"># no obvious difference</span>
<span class="functioncall">table</span>(ss[ss$Status == <span class="string">"basal"</span>, <span class="string">"basalLfCt"</span>])
</pre></div><div class="output"><pre class="knitr r">## 
##  1  2  3  4  5  6  7  8  9 10 11 12 14 15 16 19 
##  3 33 69 68 47 14 11  8  7  2  3  1  2  1  1  1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">sum</span>(ss[ss$Status == <span class="string">"basal"</span>, <span class="string">"basalLfCt"</span>] &lt;= 3)
</pre></div><div class="output"><pre class="knitr r">## [1] 105
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">sum</span>(ss[ss$Status == <span class="string">"basal"</span>, <span class="string">"basalLfCt"</span>] &gt;= 4)
</pre></div><div class="output"><pre class="knitr r">## [1] 166
</pre></div><div class="source"><pre class="knitr r">
ss$lfClass &lt;- <span class="string">""</span>
ss[ss$basalLfCt &gt;= 4, <span class="string">"lfClass"</span>] &lt;- <span class="string">"&gt;3"</span>
ss[ss$basalLfCt &lt;= 3, <span class="string">"lfClass"</span>] &lt;- <span class="string">"1-3"</span>
ss[ss$Status == <span class="string">"flowering"</span>, <span class="string">"lfClass"</span>] &lt;- <span class="string">"flowering"</span>
ss$lfClass &lt;- <span class="functioncall">factor</span>(ss$lfClass, levels = <span class="functioncall">c</span>(<span class="string">"1-3"</span>, <span class="string">"&gt;3"</span>, <span class="string">"flowering"</span>))
(uu &lt;- <span class="functioncall">table</span>(ss$lfClass, ss$siteOfOriginPedigree))  #look at distribution of plant sizes/status among pops
</pre></div><div class="output"><pre class="knitr r">##            
##             TH BTG gc ri kj aa mapp tower alf nwlf lc ness lf spp
##   1-3        1   2  2  3  2  3    5     7   6    8  8    5 19  34
##   >3         0   2  5  9  7 13    6    13   8    8 13   23 24  35
##   flowering  1   0  3  4  7  4    9     7   9   10  6   21 10  35
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">apply</span>(uu, 2, sum)  #exclude sites with &lt;10 plants
</pre></div><div class="output"><pre class="knitr r">##    TH   BTG    gc    ri    kj    aa  mapp tower   alf  nwlf    lc  ness 
##     2     4    10    16    16    20    20    27    23    26    27    49 
##    lf   spp 
##    53   104
</pre></div><div class="source"><pre class="knitr r">
ss &lt;- ss[!ss$siteOfOriginPedigree %<span class="keyword">in</span>% <span class="functioncall">c</span>(<span class="string">"BTG"</span>, <span class="string">"TH"</span>), ]
ss$siteOfOriginPedigree &lt;- <span class="functioncall">factor</span>(ss$siteOfOriginPedigree, levels = <span class="functioncall">c</span>(<span class="string">"gc"</span>, 
    <span class="string">"ri"</span>, <span class="string">"kj"</span>, <span class="string">"aa"</span>, <span class="string">"mapp"</span>, <span class="string">"alf"</span>, <span class="string">"tower"</span>, <span class="string">"nwlf"</span>, <span class="string">"lc"</span>, <span class="string">"ness"</span>, <span class="string">"lf"</span>, <span class="string">"spp"</span>))

<span class="functioncall">table</span>(ss$siteOfOriginPedigree)
</pre></div><div class="output"><pre class="knitr r">## 
##    gc    ri    kj    aa  mapp   alf tower  nwlf    lc  ness    lf   spp 
##    10    16    16    20    20    23    27    26    27    49    53   104
</pre></div><div class="source"><pre class="knitr r"><span class="comment"># make categories <span class="keyword">for</span> plant size and status:</span>

ss$aphids2 &lt;- <span class="functioncall">ordered</span>(ss$aphids2, levels = <span class="functioncall">c</span>(<span class="string">"0"</span>, <span class="string">"1-10"</span>, <span class="string">"11-80"</span>, <span class="string">"&gt;80"</span>))
<span class="functioncall">table</span>(ss$lfClass, ss$siteOfOriginPedigree)
</pre></div><div class="output"><pre class="knitr r">##            
##             gc ri kj aa mapp alf tower nwlf lc ness lf spp
##   1-3        2  3  2  3    5   6     7    8  8    5 19  34
##   >3         5  9  7 13    6   8    13    8 13   23 24  35
##   flowering  3  4  7  4    9   9     7   10  6   21 10  35
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">table</span>(ss$aphids2, ss$siteOfOriginPedigree)
</pre></div><div class="output"><pre class="knitr r">##        
##         gc ri kj aa mapp alf tower nwlf lc ness lf spp
##   0      3  8  2  4    9   2     4    5  7    9 13  25
##   1-10   1  2  2  0    1   1     2    3  3    1  6   9
##   11-80  3  4  8 10    7  16    15   12 14   25 26  55
##   >80    3  2  4  6    3   4     6    6  3   14  8  15
</pre></div><div class="source"><pre class="knitr r">
<span class="comment"># keep row and position as numeric</span>
<span class="functioncall">library</span>(MASS)
a6 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass:siteOfOriginPedigree + lfClass + siteOfOriginPedigree + 
    row + pos + date, data = ss)
</pre></div><div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
</pre></div><div class="source"><pre class="knitr r">a5 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + row + pos + date, data = ss)
<span class="functioncall">anova</span>(a5, a6)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                                                              Model
## 1                                lfClass + siteOfOriginPedigree + row + pos + date
## 2 lfClass:siteOfOriginPedigree + lfClass + siteOfOriginPedigree + row + pos + date
##   Resid. df Resid. Dev   Test    Df LR stat.  Pr(Chi)
## 1       369      802.4                               
## 2       347      757.2 1 vs 2    22    45.25 0.002469
</pre></div><div class="source"><pre class="knitr r"><span class="comment">## The error message probably means I shouldn't use the interaction</span>
<span class="comment">## between lfClass and siteOfOriginPedigree</span>
a5.1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ siteOfOriginPedigree + row + pos + date, data = ss)
a5.2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + row + pos + date, data = ss)
a5.3 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + pos + date, data = ss)
a5.4 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + row + date, data = ss)
a5.5 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + row + pos, data = ss)
<span class="functioncall">anova</span>(a5.1, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1           siteOfOriginPedigree + row + pos + date       371      848.5
## 2 lfClass + siteOfOriginPedigree + row + pos + date       369      802.4
##     Test    Df LR stat.   Pr(Chi)
## 1                                
## 2 1 vs 2     2    46.03 1.009e-10
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.2, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1                        lfClass + row + pos + date       380      818.9
## 2 lfClass + siteOfOriginPedigree + row + pos + date       369      802.4
##     Test    Df LR stat. Pr(Chi)
## 1                              
## 2 1 vs 2    11    16.44  0.1255
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.3, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1       lfClass + siteOfOriginPedigree + pos + date       370      807.7
## 2 lfClass + siteOfOriginPedigree + row + pos + date       369      802.4
##     Test    Df LR stat. Pr(Chi)
## 1                              
## 2 1 vs 2     1    5.243 0.02204
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.4, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1       lfClass + siteOfOriginPedigree + row + date       370      809.7
## 2 lfClass + siteOfOriginPedigree + row + pos + date       369      802.4
##     Test    Df LR stat.  Pr(Chi)
## 1                               
## 2 1 vs 2     1    7.214 0.007232
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.5, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1        lfClass + siteOfOriginPedigree + row + pos       373      848.0
## 2 lfClass + siteOfOriginPedigree + row + pos + date       369      802.4
##     Test    Df LR stat.   Pr(Chi)
## 1                                
## 2 1 vs 2     4    45.51 3.114e-09
</pre></div><div class="source"><pre class="knitr r">a4 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + row + pos + date, data = ss)
a4.1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ row + pos + date, data = ss)
a4.2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + pos + date, data = ss)
a4.3 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + row + date, data = ss)
a4.4 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + row + pos, data = ss)

<span class="functioncall">anova</span>(a4.1, a4)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                        Model Resid. df Resid. Dev   Test    Df LR stat.
## 1           row + pos + date       382      866.2                      
## 2 lfClass + row + pos + date       380      818.9 1 vs 2     2    47.34
##     Pr(Chi)
## 1          
## 2 5.264e-11
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.2, a4)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                        Model Resid. df Resid. Dev   Test    Df LR stat.
## 1       lfClass + pos + date       381      826.1                      
## 2 lfClass + row + pos + date       380      818.9 1 vs 2     1    7.227
##   Pr(Chi)
## 1        
## 2 0.00718
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.3, a4)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                        Model Resid. df Resid. Dev   Test    Df LR stat.
## 1       lfClass + row + date       381      826.4                      
## 2 lfClass + row + pos + date       380      818.9 1 vs 2     1    7.475
##    Pr(Chi)
## 1         
## 2 0.006256
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.4, a4)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                        Model Resid. df Resid. Dev   Test    Df LR stat.
## 1        lfClass + row + pos       384      865.2                      
## 2 lfClass + row + pos + date       380      818.9 1 vs 2     4    46.35
##     Pr(Chi)
## 1          
## 2 2.081e-09
</pre></div><div class="source"><pre class="knitr r">
a3 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + pos + date, data = ss)
a3.1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ pos + date, data = ss)
a3.2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + date, data = ss)
a3.3 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + pos, data = ss)
<span class="functioncall">anova</span>(a3.1, a3)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                  Model Resid. df Resid. Dev   Test    Df LR stat.
## 1           pos + date       383      875.0                      
## 2 lfClass + pos + date       381      826.1 1 vs 2     2    48.93
##     Pr(Chi)
## 1          
## 2 2.376e-11
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.2, a3)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                  Model Resid. df Resid. Dev   Test    Df LR stat.  Pr(Chi)
## 1       lfClass + date       382      832.9                               
## 2 lfClass + pos + date       381      826.1 1 vs 2     1    6.781 0.009214
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.3, a3)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                  Model Resid. df Resid. Dev   Test    Df LR stat.
## 1        lfClass + pos       385      865.9                      
## 2 lfClass + pos + date       381      826.1 1 vs 2     4    39.75
##     Pr(Chi)
## 1          
## 2 4.884e-08
</pre></div><div class="source"><pre class="knitr r">
a2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + date, data = ss)
a2.1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ date, data = ss)
a2.2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass, data = ss)

<span class="functioncall">anova</span>(a2.1, a2)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##            Model Resid. df Resid. Dev   Test    Df LR stat.   Pr(Chi)
## 1           date       384      889.3                                
## 2 lfClass + date       382      832.9 1 vs 2     2    56.42 5.611e-13
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a2.2, a2)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##            Model Resid. df Resid. Dev   Test    Df LR stat.   Pr(Chi)
## 1        lfClass       386      871.1                                
## 2 lfClass + date       382      832.9 1 vs 2     4    38.18 1.028e-07
</pre></div><div class="source"><pre class="knitr r">a1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass, data = ss)
null &lt;- <span class="functioncall">polr</span>(aphids2 ~ 1, data = ss)
<span class="functioncall">anova</span>(null, a1, a2, a3, a4, a5, a6)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                                                              Model
## 1                                                                                1
## 2                                                                          lfClass
## 3                                                                   lfClass + date
## 4                                                             lfClass + pos + date
## 5                                                       lfClass + row + pos + date
## 6                                lfClass + siteOfOriginPedigree + row + pos + date
## 7 lfClass:siteOfOriginPedigree + lfClass + siteOfOriginPedigree + row + pos + date
##   Resid. df Resid. Dev   Test    Df LR stat.   Pr(Chi)
## 1       388      940.2                                
## 2       386      871.1 1 vs 2     2   69.094 9.992e-16
## 3       382      832.9 2 vs 3     4   38.182 1.028e-07
## 4       381      826.1 3 vs 4     1    6.781 9.214e-03
## 5       380      818.9 4 vs 5     1    7.227 7.180e-03
## 6       369      802.4 5 vs 6    11   16.441 1.255e-01
## 7       347      757.2 6 vs 7    22   45.247 2.469e-03
</pre></div><div class="source"><pre class="knitr r">
<span class="comment">## evaluate model:</span>
best &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass * siteOfOriginPedigree + row + pos + date, data = ss)
</pre></div><div class="warning"><pre class="knitr r">## Warning: glm.fit: fitted probabilities numerically 0 or 1 occurred
</pre></div><div class="source"><pre class="knitr r"><span class="comment"># There are too many factor levels <span class="keyword">in</span> the predictors to visualize the</span>
# model <span class="keyword">in</span> this way: (pb &lt;- <span class="functioncall">profile</span>(best)) <span class="functioncall">plot</span>(pb) <span class="functioncall">pairs</span>(pb)

## use goodness of fit <span class="functioncall">test</span> (<span class="keyword">if</span> p val &gt;0.05, model is a good fit)
<span class="functioncall">pchisq</span>(<span class="functioncall">deviance</span>(best), <span class="functioncall">df.residual</span>(best))
</pre></div><div class="output"><pre class="knitr r">## [1] 1
</pre></div><div class="source"><pre class="knitr r">
<span class="comment"># compare predicted abundances to actual abundances <span class="keyword">for</span> a typical</span>
# <span class="functioncall">individual</span> (modal date and size class <span class="keyword">in</span> median location)
<span class="functioncall">table</span>(ss$lfClass)
</pre></div><div class="output"><pre class="knitr r">## 
##       1-3        >3 flowering 
##       102       164       125
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">table</span>(ss$date)
</pre></div><div class="output"><pre class="knitr r">## 
## 2004-08-07 2004-08-08 2004-08-09 2004-08-10 2004-08-12 
##        119        133        116         12         11
</pre></div><div class="source"><pre class="knitr r">newd &lt;- <span class="functioncall">data.frame</span>(lfClass = <span class="string">"&gt;3"</span>, date = <span class="string">"2004-08-08"</span>, pos = <span class="functioncall">median</span>(ss$pos), 
    row = <span class="functioncall">median</span>(ss$row), siteOfOriginPedigree = <span class="functioncall">levels</span>(ss$siteOfOriginPedigree))
pred &lt;- <span class="functioncall">predict</span>(best, type = <span class="string">"prob"</span>, newdata = newd)

exp &lt;- <span class="functioncall">data.frame</span>(fit = <span class="functioncall">c</span>(pred[, 1], pred[, 2], pred[, 3], pred[, 4]), siteOfOriginPedigree = <span class="functioncall">rep</span>(<span class="functioncall">levels</span>(ss$siteOfOriginPedigree), 
    4), aphids2 &lt;- <span class="functioncall">rep</span>(<span class="functioncall">c</span>(<span class="string">"0"</span>, <span class="string">"1-10"</span>, <span class="string">"11-80"</span>, <span class="string">"&gt;80"</span>), each = 12))
exp$aphids2 &lt;- <span class="functioncall">factor</span>(exp$aphids2, levels = <span class="functioncall">c</span>(<span class="string">"&gt;80"</span>, <span class="string">"11-80"</span>, <span class="string">"1-10"</span>, <span class="string">"0"</span>))
exp$siteOfOriginPedigree &lt;- <span class="functioncall">factor</span>(exp$siteOfOriginPedigree, levels = <span class="functioncall">levels</span>(ss$siteOfOriginPedigree))
obs &lt;- <span class="functioncall">tapply</span>(ss$siteOfOriginPedigree, <span class="functioncall">list</span>(ss$siteOfOriginPedigree, ss$aphids2), 
    length)
obs[<span class="functioncall">is.na</span>(obs)] &lt;- 0
obs &lt;- obs/<span class="functioncall">apply</span>(obs, 1, sum)
obs1 &lt;- <span class="functioncall">data.frame</span>(fit = <span class="functioncall">c</span>(obs[, 1], obs[, 2], obs[, 3], obs[, 4]), aphids2 = <span class="functioncall">rep</span>(<span class="functioncall">c</span>(<span class="string">"0"</span>, 
    <span class="string">"1-10"</span>, <span class="string">"11-80"</span>, <span class="string">"&gt;80"</span>), each = 12), siteOfOriginPedigree = <span class="functioncall">factor</span>(<span class="functioncall">levels</span>(ss$siteOfOriginPedigree), 
    levels = <span class="functioncall">levels</span>(ss$siteOfOriginPedigree)))
obs1$aphids2 &lt;- <span class="functioncall">factor</span>(obs1$aphids2, levels = <span class="functioncall">c</span>(<span class="string">"&gt;80"</span>, <span class="string">"11-80"</span>, <span class="string">"1-10"</span>, <span class="string">"0"</span>))
obs1
</pre></div><div class="output"><pre class="knitr r">##        fit aphids2 siteOfOriginPedigree
## 1  0.30000       0                   gc
## 2  0.50000       0                   ri
## 3  0.12500       0                   kj
## 4  0.20000       0                   aa
## 5  0.45000       0                 mapp
## 6  0.08696       0                  alf
## 7  0.14815       0                tower
## 8  0.19231       0                 nwlf
## 9  0.25926       0                   lc
## 10 0.18367       0                 ness
## 11 0.24528       0                   lf
## 12 0.24038       0                  spp
## 13 0.10000    1-10                   gc
## 14 0.12500    1-10                   ri
## 15 0.12500    1-10                   kj
## 16 0.00000    1-10                   aa
## 17 0.05000    1-10                 mapp
## 18 0.04348    1-10                  alf
## 19 0.07407    1-10                tower
## 20 0.11538    1-10                 nwlf
## 21 0.11111    1-10                   lc
## 22 0.02041    1-10                 ness
## 23 0.11321    1-10                   lf
## 24 0.08654    1-10                  spp
## 25 0.30000   11-80                   gc
## 26 0.25000   11-80                   ri
## 27 0.50000   11-80                   kj
## 28 0.50000   11-80                   aa
## 29 0.35000   11-80                 mapp
## 30 0.69565   11-80                  alf
## 31 0.55556   11-80                tower
## 32 0.46154   11-80                 nwlf
## 33 0.51852   11-80                   lc
## 34 0.51020   11-80                 ness
## 35 0.49057   11-80                   lf
## 36 0.52885   11-80                  spp
## 37 0.30000     >80                   gc
## 38 0.12500     >80                   ri
## 39 0.25000     >80                   kj
## 40 0.30000     >80                   aa
## 41 0.15000     >80                 mapp
## 42 0.17391     >80                  alf
## 43 0.22222     >80                tower
## 44 0.23077     >80                 nwlf
## 45 0.11111     >80                   lc
## 46 0.28571     >80                 ness
## 47 0.15094     >80                   lf
## 48 0.14423     >80                  spp
</pre></div><div class="source"><pre class="knitr r">zz &lt;- <span class="functioncall">tapply</span>(exp$fit, <span class="functioncall">list</span>(exp$aphids2, exp$siteOfOriginPedigree), mean)

zz1 &lt;- <span class="functioncall">tapply</span>(obs1$fit, <span class="functioncall">list</span>(obs1$aphids2, obs1$siteOfOriginPedigree), mean)

<span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 2))
bp &lt;- <span class="functioncall">barplot</span>(zz)
<span class="functioncall">text</span>(bp, 0.97, labels = <span class="functioncall">table</span>(ss$siteOfOriginPedigree), col = <span class="string">"red"</span>)
<span class="functioncall">legend</span>(<span class="string">"center"</span>, legend = <span class="string">"pred."</span>, bty = <span class="string">"n"</span>)
bp &lt;- <span class="functioncall">barplot</span>(zz1)
<span class="functioncall">text</span>(bp, 0.97, labels = <span class="functioncall">table</span>(ss$siteOfOriginPedigree), col = <span class="string">"red"</span>)
<span class="functioncall">legend</span>(<span class="string">"center"</span>, legend = <span class="string">"obs."</span>, bty = <span class="string">"n"</span>)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-102.png" title="plot of chunk unnamed-chunk-10" alt="plot of chunk unnamed-chunk-10" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 1))

<span class="comment"># it looks pretty good.</span>
</pre></div></div></div>


Compare results to binomial glm with aphid presence/absence:
<div class="chunk" id="unnamed-chunk-11"><div class="rcode"><div class="source"><pre class="knitr r">ss$aphidsPresent &lt;- 0
ss[ss$aphids2 != <span class="string">"0"</span>, <span class="string">"aphidsPresent"</span>] &lt;- 1

a6 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
    lfClass + row + pos + date, family = quasibinomial, data = ss)
# <span class="functioncall">summary</span>(a6) overdispersion, use quasibinomial
a5 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + date, 
    family = quasibinomial, data = ss)
<span class="functioncall">anova</span>(a5, a6, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
## Model 2: aphidsPresent ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
##     lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)   
## 1       371        328                           
## 2       349        290 22     38.4 1.92 0.0081 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">a5.1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ +lfClass + row + pos + date, family = quasibinomial, 
    data = ss)
a5.2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + row + pos + date, family = quasibinomial, 
    data = ss)
a5.3 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + lfClass + pos + date, family = quasibinomial, 
    data = ss)
a5.4 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + lfClass + row + date, family = quasibinomial, 
    data = ss)
a5.5 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos, family = quasibinomial, 
    data = ss)
<span class="functioncall">anova</span>(a5.1, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ +lfClass + row + pos + date
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       382        344                        
## 2       371        328 11     15.5 1.31   0.22
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.2, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + row + pos + date
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       373        346                             
## 2       371        328  2     17.5 8.14 0.00035 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.3, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + lfClass + pos + date
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance  F Pr(>F)   
## 1       372        340                         
## 2       371        328  1     11.8 11  0.001 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.4, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + date
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)   
## 1       372        339                           
## 2       371        328  1     10.3 9.63 0.0021 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.5, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       375        359                             
## 2       371        328  4     31.1 7.24 1.3e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
a4 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row + pos + date, family = quasibinomial, 
    data = ss)
a4.1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ row + pos + date, family = quasibinomial, data = ss)
a4.2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + pos + date, family = quasibinomial, data = ss)
a4.3 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row + date, family = quasibinomial, data = ss)
a4.4 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row + pos, family = quasibinomial, data = ss)
<span class="functioncall">anova</span>(a4.1, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ row + pos + date
## Model 2: aphidsPresent ~ lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       384        361                             
## 2       382        344  2     16.7 7.88 0.00044 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.2, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + pos + date
## Model 2: aphidsPresent ~ lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance  F  Pr(>F)    
## 1       383        360                           
## 2       382        344  1     15.8 15 0.00013 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.3, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + row + date
## Model 2: aphidsPresent ~ lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)   
## 1       383        354                           
## 2       382        344  1     10.4 9.83 0.0018 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.4, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + row + pos
## Model 2: aphidsPresent ~ lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)    
## 1       386        375                            
## 2       382        344  4     31.4 7.43  9e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
a3 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row + date, family = quasibinomial, data = ss)
a3.1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ row + date, family = quasibinomial, data = ss)
a3.2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + date, family = quasibinomial, data = ss)
a3.3 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row, family = quasibinomial, data = ss)

<span class="functioncall">anova</span>(a3.1, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ row + date
## Model 2: aphidsPresent ~ lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       385        377                             
## 2       383        354  2     22.9 10.5 3.6e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.2, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + date
## Model 2: aphidsPresent ~ lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       384        368                             
## 2       383        354  1     13.8 12.6 0.00042 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.3, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + row
## Model 2: aphidsPresent ~ lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)    
## 1       387        383                            
## 2       383        354  4     28.6 6.57  4e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
a2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + date, family = quasibinomial, data = ss)
a2.1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ date, family = quasibinomial, data = ss)
a2.2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass, family = quasibinomial, data = ss)
<span class="functioncall">anova</span>(a2.1, a2, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ date
## Model 2: aphidsPresent ~ lfClass + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       386        393                             
## 2       384        368  2     25.1 12.3 6.7e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a2.2, a2, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass
## Model 2: aphidsPresent ~ lfClass + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       388        390                             
## 2       384        368  4     21.5 5.27 0.00038 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">a1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass, family = quasibinomial, data = ss)
null &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ 1, family = quasibinomial, data = ss)
<span class="functioncall">anova</span>(null, a1, a2, a3, a4, a5, a6, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ 1
## Model 2: aphidsPresent ~ lfClass
## Model 3: aphidsPresent ~ lfClass + date
## Model 4: aphidsPresent ~ lfClass + row + date
## Model 5: aphidsPresent ~ lfClass + row + pos + date
## Model 6: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
## Model 7: aphidsPresent ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
##     lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance     F  Pr(>F)    
## 1       390        424                              
## 2       388        390  2     34.7 19.11 1.3e-08 ***
## 3       384        368  4     21.5  5.93 0.00013 ***
## 4       383        354  1     13.8 15.14 0.00012 ***
## 5       382        344  1     10.4 11.45 0.00080 ***
## 6       371        328 11     15.5  1.55 0.11299    
## 7       349        290 22     38.4  1.92 0.00812 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
<span class="comment"># evaluate best model:</span>
best &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass * siteOfOriginPedigree + date + row + pos, 
    family = quasibinomial, data = ss)
<span class="functioncall">summary</span>(best)
</pre></div><div class="output"><pre class="knitr r">## 
## Call:
## glm(formula = aphidsPresent ~ lfClass * siteOfOriginPedigree + 
##     date + row + pos, family = quasibinomial, data = ss)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -2.555   0.000   0.315   0.647   2.276  
## 
## Coefficients:
##                                             Estimate Std. Error t value
## (Intercept)                                  99.3740    24.4687    4.06
## lfClass>3                                    -1.6610     1.7368   -0.96
## lfClassflowering                             16.4561  5432.3401    0.00
## siteOfOriginPedigreeri                      -17.9739  2315.8665   -0.01
## siteOfOriginPedigreekj                       18.3455  7228.5968    0.00
## siteOfOriginPedigreeaa                        0.4527     1.8737    0.24
## siteOfOriginPedigreemapp                     -2.3079     1.8423   -1.25
## siteOfOriginPedigreealf                      -1.6605     1.7604   -0.94
## siteOfOriginPedigreetower                    -1.0221     1.7191   -0.59
## siteOfOriginPedigreenwlf                     -0.3701     1.6801   -0.22
## siteOfOriginPedigreelc                       -2.1779     1.6534   -1.32
## siteOfOriginPedigreeness                     -3.3502     1.9636   -1.71
## siteOfOriginPedigreelf                       -1.3223     1.5323   -0.86
## siteOfOriginPedigreespp                      -0.9206     1.4907   -0.62
## date2004-08-08                                0.1124     0.3407    0.33
## date2004-08-09                                1.7766     0.4312    4.12
## date2004-08-10                               34.0691  3320.0300    0.01
## date2004-08-12                               -0.9553     0.7820   -1.22
## row                                          -0.0794     0.0211   -3.77
## pos                                          -0.0988     0.0247   -3.99
## lfClass>3:siteOfOriginPedigreeri             17.2778  2315.8668    0.01
## lfClassflowering:siteOfOriginPedigreeri      19.8307  7494.4565    0.00
## lfClass>3:siteOfOriginPedigreekj            -16.6354  7228.5970    0.00
## lfClassflowering:siteOfOriginPedigreekj     -34.6254  9042.2857    0.00
## lfClass>3:siteOfOriginPedigreeaa              1.5785     2.2496    0.70
## lfClassflowering:siteOfOriginPedigreeaa     -18.6925  5432.3403    0.00
## lfClass>3:siteOfOriginPedigreemapp            2.6372     2.2500    1.17
## lfClassflowering:siteOfOriginPedigreemapp   -15.0256  5432.3402    0.00
## lfClass>3:siteOfOriginPedigreealf            21.2131  3244.7583    0.01
## lfClassflowering:siteOfOriginPedigreealf      2.9928  6291.0490    0.00
## lfClass>3:siteOfOriginPedigreetower          20.0492  2653.7511    0.01
## lfClassflowering:siteOfOriginPedigreetower  -16.9782  5432.3402    0.00
## lfClass>3:siteOfOriginPedigreenwlf            1.3260     2.1898    0.61
## lfClassflowering:siteOfOriginPedigreenwlf   -17.1145  5432.3402    0.00
## lfClass>3:siteOfOriginPedigreelc              3.9498     2.0802    1.90
## lfClassflowering:siteOfOriginPedigreelc       2.8082  6727.8176    0.00
## lfClass>3:siteOfOriginPedigreeness            5.0258     2.2739    2.21
## lfClassflowering:siteOfOriginPedigreeness   -12.1158  5432.3403    0.00
## lfClass>3:siteOfOriginPedigreelf              3.6214     1.9209    1.89
## lfClassflowering:siteOfOriginPedigreelf       3.0431  6249.0396    0.00
## lfClass>3:siteOfOriginPedigreespp             2.3485     1.8422    1.27
## lfClassflowering:siteOfOriginPedigreespp    -15.8420  5432.3401    0.00
##                                            Pr(>|t|)    
## (Intercept)                                 6.0e-05 ***
## lfClass>3                                   0.33955    
## lfClassflowering                            0.99758    
## siteOfOriginPedigreeri                      0.99381    
## siteOfOriginPedigreekj                      0.99798    
## siteOfOriginPedigreeaa                      0.80922    
## siteOfOriginPedigreemapp                    0.21113    
## siteOfOriginPedigreealf                     0.34621    
## siteOfOriginPedigreetower                   0.55251    
## siteOfOriginPedigreenwlf                    0.82579    
## siteOfOriginPedigreelc                      0.18862    
## siteOfOriginPedigreeness                    0.08888 .  
## siteOfOriginPedigreelf                      0.38874    
## siteOfOriginPedigreespp                     0.53724    
## date2004-08-08                              0.74155    
## date2004-08-09                              4.7e-05 ***
## date2004-08-10                              0.99182    
## date2004-08-12                              0.22267    
## row                                         0.00019 ***
## pos                                         7.9e-05 ***
## lfClass>3:siteOfOriginPedigreeri            0.99405    
## lfClassflowering:siteOfOriginPedigreeri     0.99789    
## lfClass>3:siteOfOriginPedigreekj            0.99817    
## lfClassflowering:siteOfOriginPedigreekj     0.99695    
## lfClass>3:siteOfOriginPedigreeaa            0.48336    
## lfClassflowering:siteOfOriginPedigreeaa     0.99726    
## lfClass>3:siteOfOriginPedigreemapp          0.24196    
## lfClassflowering:siteOfOriginPedigreemapp   0.99779    
## lfClass>3:siteOfOriginPedigreealf           0.99479    
## lfClassflowering:siteOfOriginPedigreealf    0.99962    
## lfClass>3:siteOfOriginPedigreetower         0.99398    
## lfClassflowering:siteOfOriginPedigreetower  0.99751    
## lfClass>3:siteOfOriginPedigreenwlf          0.54521    
## lfClassflowering:siteOfOriginPedigreenwlf   0.99749    
## lfClass>3:siteOfOriginPedigreelc            0.05842 .  
## lfClassflowering:siteOfOriginPedigreelc     0.99967    
## lfClass>3:siteOfOriginPedigreeness          0.02774 *  
## lfClassflowering:siteOfOriginPedigreeness   0.99822    
## lfClass>3:siteOfOriginPedigreelf            0.06022 .  
## lfClassflowering:siteOfOriginPedigreelf     0.99961    
## lfClass>3:siteOfOriginPedigreespp           0.20320    
## lfClassflowering:siteOfOriginPedigreespp    0.99767    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
## 
## (Dispersion parameter for quasibinomial family taken to be 0.9087)
## 
##     Null deviance: 424.28  on 390  degrees of freedom
## Residual deviance: 289.94  on 349  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 18
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(2, 2))
<span class="functioncall">plot</span>(best)
</pre></div><div class="warning"><pre class="knitr r">## Warning: NaNs produced
</pre></div><div class="warning"><pre class="knitr r">## Warning: NaNs produced
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-11.png" title="plot of chunk unnamed-chunk-11" alt="plot of chunk unnamed-chunk-11" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 1))
</pre></div></div></div>



Compare results to binomial glm with low( 0-10) vs high (>10) aphid abundance:
<div class="chunk" id="unnamed-chunk-12"><div class="rcode"><div class="source"><pre class="knitr r">
ss$aphidLH &lt;- 0
ss[ss$aphids2 %<span class="keyword">in</span>% <span class="functioncall">c</span>(<span class="string">"0"</span>, <span class="string">"1-10"</span>), <span class="string">"aphidLH"</span>] &lt;- 0
ss[ss$aphids2 %<span class="keyword">in</span>% <span class="functioncall">c</span>(<span class="string">"11-80"</span>, <span class="string">"&gt;80"</span>), <span class="string">"aphidLH"</span>] &lt;- 1

a6 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + lfClass + 
    row + pos + date, family = quasibinomial, data = ss)
# <span class="functioncall">summary</span>(a6) overdispersion--use quasibinomial
a5 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date, family = quasibinomial, 
    data = ss)
<span class="functioncall">anova</span>(a5, a6, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
## Model 2: aphidLH ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
##     lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)  
## 1       371        375                          
## 2       349        335 22     39.5 1.86  0.011 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">a5.1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + row + pos + date, family = quasibinomial, data = ss)
a5.2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + row + pos + date, family = quasibinomial, 
    data = ss)
a5.3 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + pos + date, family = quasibinomial, 
    data = ss)
a5.4 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + row + date, family = quasibinomial, 
    data = ss)
a5.5 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + row + pos, family = quasibinomial, 
    data = ss)
<span class="functioncall">anova</span>(a5.1, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ lfClass + row + pos + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)  
## 1       382        395                          
## 2       371        375 11     20.9 1.86  0.043 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.2, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + row + pos + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       373        410                             
## 2       371        375  2       35 17.2 7.3e-08 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.3, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + pos + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)  
## 1       372        378                          
## 2       371        375  1     2.99 2.94  0.087 .
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.4, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + row + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       372        377                        
## 2       371        375  1     2.02 1.98   0.16
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.5, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       375        409                             
## 2       371        375  4     34.1 8.37 1.8e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
a4 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + pos + date, family = quasibinomial, 
    data = ss)


a4.1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + pos + date, family = quasibinomial, data = ss)
a4.2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + pos + date, family = quasibinomial, 
    data = ss)
a4.3 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + date, family = quasibinomial, 
    data = ss)
a4.4 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + pos, family = quasibinomial, 
    data = ss)

<span class="functioncall">anova</span>(a4.1, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ lfClass + pos + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)  
## 1       383        401                          
## 2       372        378 11       23 2.08  0.021 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.2, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + pos + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + pos + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       374        415                             
## 2       372        378  2     36.9 18.3 2.6e-08 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.3, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       373        379                        
## 2       372        378  1     1.57 1.56   0.21
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.4, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + pos
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + pos + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       376        409                             
## 2       372        378  4     31.1 7.73 5.4e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
a3 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + date, family = quasibinomial, 
    data = ss)
a3.1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + date, family = quasibinomial, data = ss)
a3.2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + date, family = quasibinomial, data = ss)
a3.3 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass, family = quasibinomial, 
    data = ss)

<span class="functioncall">anova</span>(a3.1, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ lfClass + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)  
## 1       384        403                          
## 2       373        379 11     23.4 2.11  0.019 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.2, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)    
## 1       375        421                            
## 2       373        379  2     41.8 20.7  3e-09 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.3, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       377        410                             
## 2       373        379  4     30.4 7.53 7.7e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
a2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + date, family = quasibinomial, data = ss)
a2.1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ date, family = quasibinomial, data = ss)
a2.2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass, family = quasibinomial, data = ss)
<span class="functioncall">anova</span>(a2.1, a2, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ date
## Model 2: aphidLH ~ lfClass + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       386        444                             
## 2       384        403  2     41.8 20.7 2.9e-09 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a2.2, a2, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ lfClass
## Model 2: aphidLH ~ lfClass + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       388        431                             
## 2       384        403  4       28 6.94 2.1e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">a1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass, family = quasibinomial, data = ss)
null &lt;- <span class="functioncall">glm</span>(aphidLH ~ 1, family = quasibinomial, data = ss)
<span class="functioncall">anova</span>(null, a1, a2, a3, a4, a5, a6, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ 1
## Model 2: aphidLH ~ lfClass
## Model 3: aphidLH ~ lfClass + date
## Model 4: aphidLH ~ siteOfOriginPedigree + lfClass + date
## Model 5: aphidLH ~ siteOfOriginPedigree + lfClass + pos + date
## Model 6: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
## Model 7: aphidLH ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
##     lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance     F  Pr(>F)    
## 1       390        485                              
## 2       388        431  2     54.8 28.42 3.7e-12 ***
## 3       384        403  4     28.0  7.27 1.2e-05 ***
## 4       373        379 11     23.4  2.21   0.014 *  
## 5       372        378  1      1.6  1.63   0.203    
## 6       371        375  1      3.0  3.10   0.079 .  
## 7       349        335 22     39.5  1.86   0.011 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
<span class="comment"># evaluate best model:</span>
best &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree * lfClass + date, family = quasibinomial, 
    data = ss)
<span class="functioncall">summary</span>(best)
</pre></div><div class="output"><pre class="knitr r">## 
## Call:
## glm(formula = aphidLH ~ siteOfOriginPedigree * lfClass + date, 
##     family = quasibinomial, data = ss)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -2.340  -0.553   0.389   0.745   2.190  
## 
## Coefficients:
##                                             Estimate Std. Error t value
## (Intercept)                                  -0.0992     1.4264   -0.07
## siteOfOriginPedigreeri                      -16.2618  1431.7735   -0.01
## siteOfOriginPedigreekj                       18.5661  4531.4939    0.00
## siteOfOriginPedigreeaa                        0.7596     1.8511    0.41
## siteOfOriginPedigreemapp                    -18.2900  2780.0965   -0.01
## siteOfOriginPedigreealf                       0.3433     1.6795    0.20
## siteOfOriginPedigreetower                    -0.0968     1.6425   -0.06
## siteOfOriginPedigreenwlf                     -0.2275     1.5783   -0.14
## siteOfOriginPedigreelc                       -2.3018     1.7710   -1.30
## siteOfOriginPedigreeness                     -1.6321     1.8056   -0.90
## siteOfOriginPedigreelf                       -0.8020     1.4976   -0.54
## siteOfOriginPedigreespp                      -0.3571     1.4422   -0.25
## lfClass>3                                    -0.8807     1.6860   -0.52
## lfClassflowering                             16.8059  3364.4320    0.00
## date2004-08-08                                0.0992     0.3223    0.31
## date2004-08-09                                1.2637     0.3719    3.40
## date2004-08-10                               31.9885  2055.3325    0.02
## date2004-08-12                               -1.4112     0.9477   -1.49
## siteOfOriginPedigreeri:lfClass>3             14.9815  1431.7742    0.01
## siteOfOriginPedigreekj:lfClass>3            -16.3069  4531.4941    0.00
## siteOfOriginPedigreeaa:lfClass>3              1.6348     2.2296    0.73
## siteOfOriginPedigreemapp:lfClass>3           19.0395  2780.0968    0.01
## siteOfOriginPedigreealf:lfClass>3            18.8978  2212.1378    0.01
## siteOfOriginPedigreetower:lfClass>3           3.0296     2.1667    1.40
## siteOfOriginPedigreenwlf:lfClass>3            1.5566     2.0184    0.77
## siteOfOriginPedigreelc:lfClass>3              4.7143     2.1609    2.18
## siteOfOriginPedigreeness:lfClass>3            3.5505     2.1016    1.69
## siteOfOriginPedigreelf:lfClass>3              2.9096     1.8413    1.58
## siteOfOriginPedigreespp:lfClass>3             1.8034     1.7679    1.02
## siteOfOriginPedigreeri:lfClassflowering      17.8163  4812.1176    0.00
## siteOfOriginPedigreekj:lfClassflowering     -35.3409  5643.9205   -0.01
## siteOfOriginPedigreeaa:lfClassflowering     -17.2814  3364.4324   -0.01
## siteOfOriginPedigreemapp:lfClassflowering     2.0747  4364.4402    0.00
## siteOfOriginPedigreealf:lfClassflowering      1.1666  3950.6527    0.00
## siteOfOriginPedigreetower:lfClassflowering  -16.0627  3364.4322    0.00
## siteOfOriginPedigreenwlf:lfClassflowering   -15.8494  3364.4322    0.00
## siteOfOriginPedigreelc:lfClassflowering     -13.3419  3364.4323    0.00
## siteOfOriginPedigreeness:lfClassflowering   -12.4038  3364.4323    0.00
## siteOfOriginPedigreelf:lfClassflowering     -13.9193  3364.4322    0.00
## siteOfOriginPedigreespp:lfClassflowering    -15.2083  3364.4320    0.00
##                                            Pr(>|t|)    
## (Intercept)                                 0.94461    
## siteOfOriginPedigreeri                      0.99094    
## siteOfOriginPedigreekj                      0.99673    
## siteOfOriginPedigreeaa                      0.68178    
## siteOfOriginPedigreemapp                    0.99475    
## siteOfOriginPedigreealf                     0.83813    
## siteOfOriginPedigreetower                   0.95304    
## siteOfOriginPedigreenwlf                    0.88549    
## siteOfOriginPedigreelc                      0.19456    
## siteOfOriginPedigreeness                    0.36666    
## siteOfOriginPedigreelf                      0.59264    
## siteOfOriginPedigreespp                     0.80459    
## lfClass>3                                   0.60175    
## lfClassflowering                            0.99602    
## date2004-08-08                              0.75852    
## date2004-08-09                              0.00076 ***
## date2004-08-10                              0.98759    
## date2004-08-12                              0.13735    
## siteOfOriginPedigreeri:lfClass>3            0.99166    
## siteOfOriginPedigreekj:lfClass>3            0.99713    
## siteOfOriginPedigreeaa:lfClass>3            0.46390    
## siteOfOriginPedigreemapp:lfClass>3          0.99454    
## siteOfOriginPedigreealf:lfClass>3           0.99319    
## siteOfOriginPedigreetower:lfClass>3         0.16293    
## siteOfOriginPedigreenwlf:lfClass>3          0.44109    
## siteOfOriginPedigreelc:lfClass>3            0.02980 *  
## siteOfOriginPedigreeness:lfClass>3          0.09202 .  
## siteOfOriginPedigreelf:lfClass>3            0.11496    
## siteOfOriginPedigreespp:lfClass>3           0.30840    
## siteOfOriginPedigreeri:lfClassflowering     0.99705    
## siteOfOriginPedigreekj:lfClassflowering     0.99501    
## siteOfOriginPedigreeaa:lfClassflowering     0.99590    
## siteOfOriginPedigreemapp:lfClassflowering   0.99962    
## siteOfOriginPedigreealf:lfClassflowering    0.99976    
## siteOfOriginPedigreetower:lfClassflowering  0.99619    
## siteOfOriginPedigreenwlf:lfClassflowering   0.99624    
## siteOfOriginPedigreelc:lfClassflowering     0.99684    
## siteOfOriginPedigreeness:lfClassflowering   0.99706    
## siteOfOriginPedigreelf:lfClassflowering     0.99670    
## siteOfOriginPedigreespp:lfClassflowering    0.99640    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
## 
## (Dispersion parameter for quasibinomial family taken to be 0.9653)
## 
##     Null deviance: 485.39  on 390  degrees of freedom
## Residual deviance: 343.19  on 351  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 17
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(2, 2))
<span class="functioncall">plot</span>(best)
</pre></div><div class="warning"><pre class="knitr r">## Warning: NaNs produced
</pre></div><div class="warning"><pre class="knitr r">## Warning: NaNs produced
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-12.png" title="plot of chunk unnamed-chunk-12" alt="plot of chunk unnamed-chunk-12" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 1))

<span class="comment"># predict values based on typical individual, across all populations</span>
<span class="functioncall">table</span>(ss$lfClass)
</pre></div><div class="output"><pre class="knitr r">## 
##       1-3        >3 flowering 
##       102       164       125
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">table</span>(ss$date)
</pre></div><div class="output"><pre class="knitr r">## 
## 2004-08-07 2004-08-08 2004-08-09 2004-08-10 2004-08-12 
##        119        133        116         12         11
</pre></div><div class="source"><pre class="knitr r">sites &lt;- <span class="functioncall">dimnames</span>(<span class="functioncall">sort</span>(<span class="functioncall">table</span>(ss$siteOfOriginPedigree)))[[1]]
newd &lt;- <span class="functioncall">data.frame</span>(siteOfOriginPedigree = sites, lfClass = <span class="string">"&gt;3"</span>, date = <span class="string">"2004-08-08"</span>)
pred &lt;- <span class="functioncall">predict</span>(best, type = <span class="string">"response"</span>, newdata = newd, se.fit = T)
newd$fit &lt;- pred$fit
newd$se &lt;- pred$se.fit

ss$siteOfOriginPedigree &lt;- <span class="functioncall">factor</span>(ss$siteOfOriginPedigree, levels = sites)
obs &lt;- <span class="functioncall">tapply</span>(ss$aphidLH, ss$siteOfOriginPedigree, mean)
<span class="comment"># compare predicted to observed values:</span>
</pre></div></div></div>


<div class="chunk" id="unnamed-chunk-13"><div class="rcode"><div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 2))
bp &lt;- <span class="functioncall">barplot</span>(newd$fit, ylim = <span class="functioncall">c</span>(0, 1))
<span class="functioncall">segments</span>(bp, newd$fit + newd$se, bp, newd$fit - newd$se)
<span class="functioncall">text</span>(bp, 0.03, labels = sites)
bp &lt;- <span class="functioncall">barplot</span>(obs, ylim = <span class="functioncall">c</span>(0, 1))
<span class="functioncall">text</span>(bp, 0.03, labels = sites)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-13.png" title="plot of chunk unnamed-chunk-13" alt="plot of chunk unnamed-chunk-13" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 1))
</pre></div></div></div>

<b>Summary for 1997 garden, 2004</b>

<p><b>1. POLR of 4 categories of aphid abundance </b>(0,1-10, 11-80,>80)</p>
<p>The best model included size/status (p<0.0001),measure date (p<0.0001), position (p=0.009), and the interaction between maternal population and size/status (p=0.0025). The main effect of maternal population was not significant (p=0.126). One issue with this model is that I get an error message (fitted probabilities of 0 or 1 occurred) when I include the interaction between site and size/status. However, the model passed the goodness of fit test.  
</p>

<p><b>2. GLM quasibinomial of aphid presence/absence</b></p>
<p>The best model had the same factors as the POLR: size/class (p<0.0001), date (p=0.00012), row(0.00012), position (p=0.0008), and the interaction between size/class and maternal population (p=0.008). Similar to the POLR, the main effect of maternal population was not significant (p=0.113). The qq plot looked okay--much better than the one for the presence/absence model in the 1996 garden. </p>

<p>3. GLM quasibinomial of low (1-10) vs. high (>10) aphid abundance</p>:
Similar to the first 2 models, the best model included size/status (p<0.0001), date (p<0.0001), and the interaction between size/status and maternal population (p=0.0114). However, unlike in the other models, row was not significant (p=0.203) and position was marginally significant (p=0.08). Also, the main effect of maternal population was significant at p=0.0138. The qq plot looked decent--better than the one for presence/absence. This is probably the most suitable model for the 1997 garden in 2004.

<p>Next step: 1997 garden, 2005</p>
<div class="chunk" id="unnamed-chunk-14"><div class="rcode"><div class="source"><pre class="knitr r"><span class="comment"># look at differences by measuredate</span>
ss &lt;- pp97[pp97$measureYr == 2005, ]
<span class="functioncall">table</span>(ss$measureDt2)
</pre></div><div class="output"><pre class="knitr r">## 
## 2005-08-11 2005-08-12 2005-08-14 2005-08-17 2005-08-19 2005-08-29 
##         77         90         94         77         28          5
</pre></div><div class="source"><pre class="knitr r">
<span class="comment"># exclude 2005-08-20</span>
ss &lt;- ss[ss$measureDt2 != <span class="string">"2005-08-29"</span>, ]
ss$date &lt;- <span class="functioncall">factor</span>(ss$measureDt2)
zz &lt;- <span class="functioncall">tapply</span>(ss$aphids2, <span class="functioncall">list</span>(ss$aphids2, ss$date), length)
zz[<span class="functioncall">is.na</span>(zz)] &lt;- 0
<span class="functioncall">barplot</span>(zz)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-14.png" title="plot of chunk unnamed-chunk-14" alt="plot of chunk unnamed-chunk-14" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="comment"># no obvious difference</span>
<span class="functioncall">table</span>(ss[ss$Status == <span class="string">"basal"</span>, <span class="string">"basalLfCt"</span>])
</pre></div><div class="output"><pre class="knitr r">## 
##  1  2  3  4  5  6  7  8  9 10 11 12 13 14 15 17 20 22 52 
##  8 36 53 62 51 34 22 14 14  9  8  3  6  5  7  3  1  2  1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">sum</span>(ss[ss$Status == <span class="string">"basal"</span>, <span class="string">"basalLfCt"</span>] &lt;= 4)
</pre></div><div class="output"><pre class="knitr r">## [1] 159
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">sum</span>(ss[ss$Status == <span class="string">"basal"</span>, <span class="string">"basalLfCt"</span>] &gt;= 5)
</pre></div><div class="output"><pre class="knitr r">## [1] 180
</pre></div><div class="source"><pre class="knitr r">
ss$lfClass &lt;- <span class="string">""</span>
ss[ss$basalLfCt &gt;= 5, <span class="string">"lfClass"</span>] &lt;- <span class="string">"&gt;4"</span>
ss[ss$basalLfCt &lt;= 4, <span class="string">"lfClass"</span>] &lt;- <span class="string">"1-4"</span>
ss[ss$Status == <span class="string">"flowering"</span>, <span class="string">"lfClass"</span>] &lt;- <span class="string">"flowering"</span>
ss$lfClass &lt;- <span class="functioncall">factor</span>(ss$lfClass, levels = <span class="functioncall">c</span>(<span class="string">"1-4"</span>, <span class="string">"&gt;4"</span>, <span class="string">"flowering"</span>))
(uu &lt;- <span class="functioncall">table</span>(ss$lfClass, ss$siteOfOriginPedigree))  #look at distribution of plant sizes/status among pops
</pre></div><div class="output"><pre class="knitr r">##            
##             TH BTG gc ri kj aa mapp tower alf nwlf lc ness lf spp
##   1-4        1   3  4  5  5  7    5     7  10   11 16    8 27  50
##   >4         1   0  6  7  9  8   12    14  10   12 11   30 18  42
##   flowering  0   0  0  3  0  2    1     3   1    2  1    7  2   5
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">apply</span>(uu, 2, sum)  #exclude sites with &lt;10 plants, and exclude flowering plants
</pre></div><div class="output"><pre class="knitr r">##    TH   BTG    gc    ri    kj    aa  mapp tower   alf  nwlf    lc  ness 
##     2     3    10    15    14    17    18    24    21    25    28    45 
##    lf   spp 
##    47    97
</pre></div><div class="source"><pre class="knitr r">
ss &lt;- ss[!ss$siteOfOriginPedigree %<span class="keyword">in</span>% <span class="functioncall">c</span>(<span class="string">"BTG"</span>, <span class="string">"TH"</span>), ]
<span class="comment"># exclude flowering plants:</span>
ss &lt;- ss[ss$Status != <span class="string">"flowering"</span>, ]
ss$lfClass &lt;- <span class="functioncall">factor</span>(ss$lfClass, levels = <span class="functioncall">c</span>(<span class="string">"1-4"</span>, <span class="string">"&gt;4"</span>))
ss$siteOfOriginPedigree &lt;- <span class="functioncall">factor</span>(ss$siteOfOriginPedigree, levels = <span class="functioncall">c</span>(<span class="string">"gc"</span>, 
    <span class="string">"ri"</span>, <span class="string">"kj"</span>, <span class="string">"aa"</span>, <span class="string">"mapp"</span>, <span class="string">"alf"</span>, <span class="string">"tower"</span>, <span class="string">"nwlf"</span>, <span class="string">"lc"</span>, <span class="string">"ness"</span>, <span class="string">"lf"</span>, <span class="string">"spp"</span>))

<span class="comment"># make categories <span class="keyword">for</span> plant size and status:</span>
ss$aphids2 &lt;- <span class="functioncall">ordered</span>(ss$aphids2, levels = <span class="functioncall">c</span>(<span class="string">"0"</span>, <span class="string">"1-10"</span>, <span class="string">"11-80"</span>, <span class="string">"&gt;80"</span>))
<span class="functioncall">table</span>(ss$lfClass, ss$siteOfOriginPedigree)
</pre></div><div class="output"><pre class="knitr r">##      
##       gc ri kj aa mapp alf tower nwlf lc ness lf spp
##   1-4  4  5  5  7    5  10     7   11 16    8 27  50
##   >4   6  7  9  8   12  10    14   12 11   30 18  42
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">table</span>(ss$aphids2, ss$siteOfOriginPedigree)
</pre></div><div class="output"><pre class="knitr r">##        
##         gc ri kj aa mapp alf tower nwlf lc ness lf spp
##   0      3  8  7  9   10   4     9   10 16   14 27  46
##   1-10   0  1  0  1    2   1     1    2  2    1  1   6
##   11-80  6  3  6  5    4  13     9    9  8   19 17  34
##   >80    1  0  1  0    1   2     2    2  1    4  0   6
</pre></div><div class="source"><pre class="knitr r">
<span class="comment"># keep row and position as numeric</span>
<span class="functioncall">library</span>(MASS)
a6 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass:siteOfOriginPedigree + lfClass + siteOfOriginPedigree + 
    row + pos + date, data = ss)
a5 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + row + pos + date, data = ss)
<span class="functioncall">anova</span>(a5, a6)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                                                              Model
## 1                                lfClass + siteOfOriginPedigree + row + pos + date
## 2 lfClass:siteOfOriginPedigree + lfClass + siteOfOriginPedigree + row + pos + date
##   Resid. df Resid. Dev   Test    Df LR stat. Pr(Chi)
## 1       313      614.3                              
## 2       302      603.7 1 vs 2    11    10.63  0.4749
</pre></div><div class="source"><pre class="knitr r">
a5.1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ siteOfOriginPedigree + row + pos + date, data = ss)
a5.2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + row + pos + date, data = ss)
a5.3 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + pos + date, data = ss)
a5.4 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + row + date, data = ss)
a5.5 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + row + pos, data = ss)
<span class="functioncall">anova</span>(a5.1, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1           siteOfOriginPedigree + row + pos + date       314      642.7
## 2 lfClass + siteOfOriginPedigree + row + pos + date       313      614.3
##     Test    Df LR stat.   Pr(Chi)
## 1                                
## 2 1 vs 2     1    28.34 1.016e-07
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.2, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1                        lfClass + row + pos + date       324      633.0
## 2 lfClass + siteOfOriginPedigree + row + pos + date       313      614.3
##     Test    Df LR stat. Pr(Chi)
## 1                              
## 2 1 vs 2    11    18.67 0.06731
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.3, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1       lfClass + siteOfOriginPedigree + pos + date       314      619.9
## 2 lfClass + siteOfOriginPedigree + row + pos + date       313      614.3
##     Test    Df LR stat. Pr(Chi)
## 1                              
## 2 1 vs 2     1    5.555 0.01843
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.4, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1       lfClass + siteOfOriginPedigree + row + date       314      615.3
## 2 lfClass + siteOfOriginPedigree + row + pos + date       313      614.3
##     Test    Df LR stat. Pr(Chi)
## 1                              
## 2 1 vs 2     1   0.9039  0.3417
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.5, a5)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                               Model Resid. df Resid. Dev
## 1        lfClass + siteOfOriginPedigree + row + pos       317      644.2
## 2 lfClass + siteOfOriginPedigree + row + pos + date       313      614.3
##     Test    Df LR stat.   Pr(Chi)
## 1                                
## 2 1 vs 2     4    29.85 5.254e-06
</pre></div><div class="source"><pre class="knitr r">a4 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + row + date, data = ss)
a4.1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ siteOfOriginPedigree + row + date, data = ss)
a4.2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + row + date, data = ss)
a4.3 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + date, data = ss)
a4.4 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + row, data = ss)
<span class="functioncall">anova</span>(a4.1, a4)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                         Model Resid. df Resid. Dev   Test
## 1           siteOfOriginPedigree + row + date       315      645.6       
## 2 lfClass + siteOfOriginPedigree + row + date       314      615.3 1 vs 2
##      Df LR stat.   Pr(Chi)
## 1                         
## 2     1    30.31 3.683e-08
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.2, a4)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                         Model Resid. df Resid. Dev   Test
## 1                        lfClass + row + date       325      634.9       
## 2 lfClass + siteOfOriginPedigree + row + date       314      615.3 1 vs 2
##      Df LR stat. Pr(Chi)
## 1                       
## 2    11    19.65 0.05031
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.3, a4)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                         Model Resid. df Resid. Dev   Test
## 1       lfClass + siteOfOriginPedigree + date       315      620.5       
## 2 lfClass + siteOfOriginPedigree + row + date       314      615.3 1 vs 2
##      Df LR stat. Pr(Chi)
## 1                       
## 2     1    5.215 0.02239
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.4, a4)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                         Model Resid. df Resid. Dev   Test
## 1        lfClass + siteOfOriginPedigree + row       318      644.9       
## 2 lfClass + siteOfOriginPedigree + row + date       314      615.3 1 vs 2
##      Df LR stat.   Pr(Chi)
## 1                         
## 2     4    29.61 5.863e-06
</pre></div><div class="source"><pre class="knitr r">
a3 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + row + date, data = ss)
a3.1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ row + date, data = ss)
a3.2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + date, data = ss)
a3.3 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + row, data = ss)

<span class="functioncall">anova</span>(a3.1, a3)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                  Model Resid. df Resid. Dev   Test    Df LR stat.
## 1           row + date       326      668.3                      
## 2 lfClass + row + date       325      634.9 1 vs 2     1     33.4
##     Pr(Chi)
## 1          
## 2 7.492e-09
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.2, a3)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                  Model Resid. df Resid. Dev   Test    Df LR stat.  Pr(Chi)
## 1       lfClass + date       326      642.7                               
## 2 lfClass + row + date       325      634.9 1 vs 2     1    7.766 0.005324
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.3, a3)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                  Model Resid. df Resid. Dev   Test    Df LR stat.
## 1        lfClass + row       329      661.4                      
## 2 lfClass + row + date       325      634.9 1 vs 2     4    26.47
##     Pr(Chi)
## 1          
## 2 2.546e-05
</pre></div><div class="source"><pre class="knitr r">
a2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + date, data = ss)
a2.1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ date, data = ss)
a2.2 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass, data = ss)

<span class="functioncall">anova</span>(a2.1, a2)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##            Model Resid. df Resid. Dev   Test    Df LR stat.   Pr(Chi)
## 1           date       327      674.9                                
## 2 lfClass + date       326      642.7 1 vs 2     1    32.28 1.338e-08
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a2.2, a2)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##            Model Resid. df Resid. Dev   Test    Df LR stat.   Pr(Chi)
## 1        lfClass       330      670.3                                
## 2 lfClass + date       326      642.7 1 vs 2     4    27.63 1.484e-05
</pre></div><div class="source"><pre class="knitr r">a1 &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass, data = ss)
null &lt;- <span class="functioncall">polr</span>(aphids2 ~ 1, data = ss)
<span class="functioncall">anova</span>(null, a1, a2, a3, a4, a5, a6)
</pre></div><div class="output"><pre class="knitr r">## Likelihood ratio tests of ordinal regression models
## 
## Response: aphids2
##                                                                              Model
## 1                                                                                1
## 2                                                                          lfClass
## 3                                                                   lfClass + date
## 4                                                             lfClass + row + date
## 5                                      lfClass + siteOfOriginPedigree + row + date
## 6                                lfClass + siteOfOriginPedigree + row + pos + date
## 7 lfClass:siteOfOriginPedigree + lfClass + siteOfOriginPedigree + row + pos + date
##   Resid. df Resid. Dev   Test    Df LR stat.   Pr(Chi)
## 1       331      696.6                                
## 2       330      670.3 1 vs 2     1  26.2656 2.975e-07
## 3       326      642.7 2 vs 3     4  27.6274 1.484e-05
## 4       325      634.9 3 vs 4     1   7.7661 5.324e-03
## 5       314      615.3 4 vs 5    11  19.6542 5.031e-02
## 6       313      614.3 5 vs 6     1   0.9039 3.417e-01
## 7       302      603.7 6 vs 7    11  10.6289 4.749e-01
</pre></div></div></div>


<div class="chunk" id="unnamed-chunk-15"><div class="rcode"><div class="source"><pre class="knitr r"><span class="comment">## evaluate model:</span>
best &lt;- <span class="functioncall">polr</span>(aphids2 ~ lfClass + siteOfOriginPedigree + row + date, data = ss)

<span class="comment"># There are too many factor levels <span class="keyword">in</span> the predictors to visualize the</span>
<span class="comment"># model <span class="keyword">in</span> this way:</span>
pb &lt;- <span class="functioncall">profile</span>(best)
</pre></div><div class="message"><pre class="knitr r">## Re-fitting to get Hessian
</pre></div><div class="source"><pre class="knitr r">
# <span class="functioncall">plot</span>(pb)
<span class="functioncall">pairs</span>(pb)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-15.png" title="plot of chunk unnamed-chunk-15" alt="plot of chunk unnamed-chunk-15" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r">
## use goodness of fit <span class="functioncall">test</span> (<span class="keyword">if</span> p val &gt;0.05, model is a good fit)
<span class="functioncall">pchisq</span>(<span class="functioncall">deviance</span>(best), <span class="functioncall">df.residual</span>(best))
</pre></div><div class="output"><pre class="knitr r">## [1] 1
</pre></div></div></div>


<div class="chunk" id="unnamed-chunk-16"><div class="rcode"><div class="source"><pre class="knitr r"><span class="comment"># compare predicted abundances to actual abundances <span class="keyword">for</span> a typical</span>
# <span class="functioncall">individual</span> (modal date and size class <span class="keyword">in</span> median location)
<span class="functioncall">table</span>(ss$lfClass)
</pre></div><div class="output"><pre class="knitr r">## 
## 1-4  >4 
## 155 179
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">table</span>(ss$date)
</pre></div><div class="output"><pre class="knitr r">## 
## 2005-08-11 2005-08-12 2005-08-14 2005-08-17 2005-08-19 
##         70         85         88         67         24
</pre></div><div class="source"><pre class="knitr r">newd &lt;- <span class="functioncall">data.frame</span>(lfClass = <span class="string">"&gt;4"</span>, date = <span class="string">"2005-08-14"</span>, pos = <span class="functioncall">median</span>(ss$pos), 
    row = <span class="functioncall">median</span>(ss$row), siteOfOriginPedigree = <span class="functioncall">levels</span>(ss$siteOfOriginPedigree))
pred &lt;- <span class="functioncall">predict</span>(best, type = <span class="string">"prob"</span>, newdata = newd)
exp &lt;- <span class="functioncall">data.frame</span>(fit = <span class="functioncall">c</span>(pred[, 1], pred[, 2], pred[, 3], pred[, 4]), siteOfOriginPedigree = <span class="functioncall">rep</span>(<span class="functioncall">levels</span>(ss$siteOfOriginPedigree), 
    4), aphids2 &lt;- <span class="functioncall">rep</span>(<span class="functioncall">c</span>(<span class="string">"0"</span>, <span class="string">"1-10"</span>, <span class="string">"11-80"</span>, <span class="string">"&gt;80"</span>), each = 12))
exp$aphids2 &lt;- <span class="functioncall">factor</span>(exp$aphids2, levels = <span class="functioncall">c</span>(<span class="string">"&gt;80"</span>, <span class="string">"11-80"</span>, <span class="string">"1-10"</span>, <span class="string">"0"</span>))
exp$siteOfOriginPedigree &lt;- <span class="functioncall">factor</span>(exp$siteOfOriginPedigree, levels = <span class="functioncall">levels</span>(ss$siteOfOriginPedigree))
obs &lt;- <span class="functioncall">tapply</span>(ss$siteOfOriginPedigree, <span class="functioncall">list</span>(ss$siteOfOriginPedigree, ss$aphids2), 
    length)
obs[<span class="functioncall">is.na</span>(obs)] &lt;- 0
obs &lt;- obs/<span class="functioncall">apply</span>(obs, 1, sum)

obs1 &lt;- <span class="functioncall">data.frame</span>(fit = <span class="functioncall">c</span>(obs[, 1], obs[, 2], obs[, 3], obs[, 4]), aphids2 = <span class="functioncall">rep</span>(<span class="functioncall">c</span>(<span class="string">"0"</span>, 
    <span class="string">"1-10"</span>, <span class="string">"11-80"</span>, <span class="string">"&gt;80"</span>), each = 12), siteOfOriginPedigree = <span class="functioncall">factor</span>(<span class="functioncall">levels</span>(ss$siteOfOriginPedigree), 
    levels = <span class="functioncall">levels</span>(ss$siteOfOriginPedigree)))
obs1$aphids2 &lt;- <span class="functioncall">factor</span>(obs1$aphids2, levels = <span class="functioncall">c</span>(<span class="string">"&gt;80"</span>, <span class="string">"11-80"</span>, <span class="string">"1-10"</span>, <span class="string">"0"</span>))
obs1
</pre></div><div class="output"><pre class="knitr r">##        fit aphids2 siteOfOriginPedigree
## 1  0.30000       0                   gc
## 2  0.66667       0                   ri
## 3  0.50000       0                   kj
## 4  0.60000       0                   aa
## 5  0.58824       0                 mapp
## 6  0.20000       0                  alf
## 7  0.42857       0                tower
## 8  0.43478       0                 nwlf
## 9  0.59259       0                   lc
## 10 0.36842       0                 ness
## 11 0.60000       0                   lf
## 12 0.50000       0                  spp
## 13 0.00000    1-10                   gc
## 14 0.08333    1-10                   ri
## 15 0.00000    1-10                   kj
## 16 0.06667    1-10                   aa
## 17 0.11765    1-10                 mapp
## 18 0.05000    1-10                  alf
## 19 0.04762    1-10                tower
## 20 0.08696    1-10                 nwlf
## 21 0.07407    1-10                   lc
## 22 0.02632    1-10                 ness
## 23 0.02222    1-10                   lf
## 24 0.06522    1-10                  spp
## 25 0.60000   11-80                   gc
## 26 0.25000   11-80                   ri
## 27 0.42857   11-80                   kj
## 28 0.33333   11-80                   aa
## 29 0.23529   11-80                 mapp
## 30 0.65000   11-80                  alf
## 31 0.42857   11-80                tower
## 32 0.39130   11-80                 nwlf
## 33 0.29630   11-80                   lc
## 34 0.50000   11-80                 ness
## 35 0.37778   11-80                   lf
## 36 0.36957   11-80                  spp
## 37 0.10000     >80                   gc
## 38 0.00000     >80                   ri
## 39 0.07143     >80                   kj
## 40 0.00000     >80                   aa
## 41 0.05882     >80                 mapp
## 42 0.10000     >80                  alf
## 43 0.09524     >80                tower
## 44 0.08696     >80                 nwlf
## 45 0.03704     >80                   lc
## 46 0.10526     >80                 ness
## 47 0.00000     >80                   lf
## 48 0.06522     >80                  spp
</pre></div><div class="source"><pre class="knitr r">
zz &lt;- <span class="functioncall">tapply</span>(exp$fit, <span class="functioncall">list</span>(exp$aphids2, exp$siteOfOriginPedigree), mean)
zz1 &lt;- <span class="functioncall">tapply</span>(obs1$fit, <span class="functioncall">list</span>(obs1$aphids2, obs1$siteOfOriginPedigree), mean)

<span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 2))
bp &lt;- <span class="functioncall">barplot</span>(zz)
<span class="functioncall">text</span>(bp, 0.97, labels = <span class="functioncall">table</span>(ss$siteOfOriginPedigree), col = <span class="string">"red"</span>)
<span class="functioncall">legend</span>(<span class="string">"center"</span>, legend = <span class="string">"pred."</span>, bty = <span class="string">"n"</span>)
bp &lt;- <span class="functioncall">barplot</span>(zz1)
<span class="functioncall">text</span>(bp, 0.97, labels = <span class="functioncall">table</span>(ss$siteOfOriginPedigree), col = <span class="string">"red"</span>)
<span class="functioncall">legend</span>(<span class="string">"center"</span>, legend = <span class="string">"obs."</span>, bty = <span class="string">"n"</span>)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-16.png" title="plot of chunk unnamed-chunk-16" alt="plot of chunk unnamed-chunk-16" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 1))

<span class="comment"># it looks pretty good.</span>
</pre></div></div></div>


Compare results to binomial glm with aphid presence/absence:
<div class="chunk" id="unnamed-chunk-17"><div class="rcode"><div class="source"><pre class="knitr r">ss$aphidsPresent &lt;- 0
ss[ss$aphids2 != <span class="string">"0"</span>, <span class="string">"aphidsPresent"</span>] &lt;- 1

a6 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
    lfClass + row + pos + date, family = quasibinomial, data = ss)
# <span class="functioncall">summary</span>(a6) overdispersion, use quasibinomial
a5 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + date, 
    family = quasibinomial, data = ss)
<span class="functioncall">anova</span>(a5, a6, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
## Model 2: aphidsPresent ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
##     lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       315        393                        
## 2       304        380 11     13.3 1.15   0.32
</pre></div><div class="source"><pre class="knitr r">a5.1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ +lfClass + row + pos + date, family = quasibinomial, 
    data = ss)
a5.2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + row + pos + date, family = quasibinomial, 
    data = ss)
a5.3 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + lfClass + pos + date, family = quasibinomial, 
    data = ss)
a5.4 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + lfClass + row + date, family = quasibinomial, 
    data = ss)
a5.5 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos, family = quasibinomial, 
    data = ss)
<span class="functioncall">anova</span>(a5.1, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ +lfClass + row + pos + date
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       326        408                        
## 2       315        393 11     14.7 1.28   0.24
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.2, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + row + pos + date
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       316        411                             
## 2       315        393  1     17.8 17.1 4.7e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.3, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + lfClass + pos + date
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)   
## 1       316        404                           
## 2       315        393  1     10.2 9.75  0.002 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.4, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + date
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       316        395                        
## 2       315        393  1     1.95 1.86   0.17
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.5, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos
## Model 2: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       319        416                             
## 2       315        393  4     22.3 5.33 0.00037 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
a4 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row + pos + date, family = quasibinomial, 
    data = ss)
a4.1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ row + pos + date, family = quasibinomial, data = ss)
a4.2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + pos + date, family = quasibinomial, data = ss)
a4.3 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row + date, family = quasibinomial, data = ss)
a4.4 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row + pos, family = quasibinomial, data = ss)
<span class="functioncall">anova</span>(a4.1, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ row + pos + date
## Model 2: aphidsPresent ~ lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       327        427                             
## 2       326        408  1     18.8 18.4 2.3e-05 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.2, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + pos + date
## Model 2: aphidsPresent ~ lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)    
## 1       327        421                            
## 2       326        408  1       13 12.8  4e-04 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.3, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + row + date
## Model 2: aphidsPresent ~ lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)  
## 1       327        411                          
## 2       326        408  1     3.03 2.98  0.085 .
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.4, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + row + pos
## Model 2: aphidsPresent ~ lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       330        429                             
## 2       326        408  4     20.4 5.01 0.00062 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
a3 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row + date, family = quasibinomial, data = ss)
a3.1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ row + date, family = quasibinomial, data = ss)
a3.2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + date, family = quasibinomial, data = ss)
a3.3 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + row, family = quasibinomial, data = ss)

<span class="functioncall">anova</span>(a3.1, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ row + date
## Model 2: aphidsPresent ~ lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       328        433                             
## 2       327        411  1     21.9 21.7 4.7e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.2, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + date
## Model 2: aphidsPresent ~ lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance  F  Pr(>F)    
## 1       328        423                           
## 2       327        411  1     12.1 12 0.00059 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.3, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass + row
## Model 2: aphidsPresent ~ lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       331        432                             
## 2       327        411  4     20.5 5.08 0.00056 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
a2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + date, family = quasibinomial, data = ss)
a2.1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ date, family = quasibinomial, data = ss)
a2.2 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass, family = quasibinomial, data = ss)
<span class="functioncall">anova</span>(a2.1, a2, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ date
## Model 2: aphidsPresent ~ lfClass + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       329        444                             
## 2       328        423  1     20.9 20.4 8.6e-06 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a2.2, a2, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ lfClass
## Model 2: aphidsPresent ~ lfClass + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       332        445                             
## 2       328        423  4     21.3 5.22 0.00044 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">a1 &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass, family = quasibinomial, data = ss)
null &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ 1, family = quasibinomial, data = ss)
<span class="functioncall">anova</span>(null, a1, a2, a3, a4, a5, a6, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidsPresent ~ 1
## Model 2: aphidsPresent ~ lfClass
## Model 3: aphidsPresent ~ lfClass + date
## Model 4: aphidsPresent ~ lfClass + row + date
## Model 5: aphidsPresent ~ lfClass + row + pos + date
## Model 6: aphidsPresent ~ siteOfOriginPedigree + lfClass + row + pos + 
##     date
## Model 7: aphidsPresent ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
##     lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance     F  Pr(>F)    
## 1       333        463                              
## 2       332        445  1    18.21 17.33 4.1e-05 ***
## 3       328        423  4    21.27  5.06 0.00058 ***
## 4       327        411  1    12.14 11.55 0.00077 ***
## 5       326        408  1     3.03  2.88 0.09057 .  
## 6       315        393 11    14.70  1.27 0.24033    
## 7       304        380 11    13.28  1.15 0.32304    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
<span class="comment"># evaluate best model:</span>
best &lt;- <span class="functioncall">glm</span>(aphidsPresent ~ lfClass + date + row, family = quasibinomial, data = ss)
<span class="functioncall">summary</span>(best)
</pre></div><div class="output"><pre class="knitr r">## 
## Call:
## glm(formula = aphidsPresent ~ lfClass + date + row, family = quasibinomial, 
##     data = ss)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.802  -1.043   0.524   0.940   1.841  
## 
## Coefficients:
##                Estimate Std. Error t value Pr(>|t|)    
## (Intercept)      1.3244     0.5733    2.31  0.02150 *  
## lfClass>4        1.1237     0.2476    4.54  7.9e-06 ***
## date2005-08-12  -0.4989     0.3560   -1.40  0.16201    
## date2005-08-14   0.4883     0.3499    1.40  0.16379    
## date2005-08-17  -0.7726     0.3695   -2.09  0.03733 *  
## date2005-08-19  -1.1663     0.5432   -2.15  0.03251 *  
## row             -0.0639     0.0190   -3.37  0.00085 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
## 
## (Dispersion parameter for quasibinomial family taken to be 1.01)
## 
##     Null deviance: 462.83  on 333  degrees of freedom
## Residual deviance: 411.20  on 327  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 4
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(2, 2))
<span class="functioncall">plot</span>(best)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-17.png" title="plot of chunk unnamed-chunk-17" alt="plot of chunk unnamed-chunk-17" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 1))

<span class="comment"># looks okay</span>
</pre></div></div></div>



Compare results to binomial glm with low( 0-10) vs high (>10) aphid abundance:
<div class="chunk" id="unnamed-chunk-18"><div class="rcode"><div class="source"><pre class="knitr r">
ss$aphidLH &lt;- 0
ss[ss$aphids2 %<span class="keyword">in</span>% <span class="functioncall">c</span>(<span class="string">"0"</span>, <span class="string">"1-10"</span>), <span class="string">"aphidLH"</span>] &lt;- 0
ss[ss$aphids2 %<span class="keyword">in</span>% <span class="functioncall">c</span>(<span class="string">"11-80"</span>, <span class="string">"&gt;80"</span>), <span class="string">"aphidLH"</span>] &lt;- 1

a6 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + lfClass + 
    row + pos + date, family = quasibinomial, data = ss)
# <span class="functioncall">summary</span>(a6) overdispersion--use quasibinomial
a5 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date, family = quasibinomial, 
    data = ss)
<span class="functioncall">anova</span>(a5, a6, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
## Model 2: aphidLH ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
##     lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       315        381                        
## 2       304        366 11     15.3 1.33    0.2
</pre></div><div class="source"><pre class="knitr r">a5.1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + row + pos + date, family = quasibinomial, data = ss)
a5.2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + row + pos + date, family = quasibinomial, 
    data = ss)
a5.3 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + pos + date, family = quasibinomial, 
    data = ss)
a5.4 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + row + date, family = quasibinomial, 
    data = ss)
a5.5 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + row + pos, family = quasibinomial, 
    data = ss)
<span class="functioncall">anova</span>(a5.1, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ lfClass + row + pos + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)  
## 1       326        403                          
## 2       315        381 11     21.4 1.84  0.047 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.2, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + row + pos + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance  F  Pr(>F)    
## 1       316        409                           
## 2       315        381  1     27.5 26 5.8e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.3, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + pos + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)  
## 1       316        388                          
## 2       315        381  1     6.62 6.26  0.013 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.4, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + row + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)
## 1       316        382                        
## 2       315        381  1    0.503 0.48   0.49
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a5.5, a5, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       319        406                             
## 2       315        381  4     25.2 5.97 0.00012 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
a4 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + row + date, family = quasibinomial, 
    data = ss)
a4.1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + row + date, family = quasibinomial, data = ss)
a4.2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + row + date, family = quasibinomial, 
    data = ss)
a4.3 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + date, family = quasibinomial, 
    data = ss)
a4.4 &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + row, family = quasibinomial, 
    data = ss)

<span class="functioncall">anova</span>(a4.1, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ lfClass + row + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)  
## 1       327        404                          
## 2       316        382 11       22 1.91  0.038 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.2, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + row + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance  F  Pr(>F)    
## 1       317        411                           
## 2       316        382  1     29.3 28 2.3e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.3, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + date
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)  
## 1       317        388                          
## 2       316        382  1     6.39 6.11  0.014 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a4.4, a4, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ siteOfOriginPedigree + lfClass + row
## Model 2: aphidLH ~ siteOfOriginPedigree + lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       320        407                             
## 2       316        382  4     25.3 6.04 0.00011 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
a3 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + row + date, family = quasibinomial, data = ss)
a3.1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ row + date, family = quasibinomial, data = ss)
a3.2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + date, family = quasibinomial, data = ss)
a3.3 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + row, family = quasibinomial, data = ss)

<span class="functioncall">anova</span>(a3.1, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ row + date
## Model 2: aphidLH ~ lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       328        434                             
## 2       327        404  1     30.8 30.6 6.6e-08 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.2, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ lfClass + date
## Model 2: aphidLH ~ lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F Pr(>F)   
## 1       328        412                           
## 2       327        404  1     8.69 8.63 0.0035 **
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a3.3, a3, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ lfClass + row
## Model 2: aphidLH ~ lfClass + row + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       331        425                             
## 2       327        404  4     21.1 5.25 0.00041 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
a2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass + date, family = quasibinomial, data = ss)
a2.1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ date, family = quasibinomial, data = ss)
a2.2 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass, family = quasibinomial, data = ss)
<span class="functioncall">anova</span>(a2.1, a2, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ date
## Model 2: aphidLH ~ lfClass + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       329        442                             
## 2       328        412  1     29.4 28.9 1.4e-07 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">anova</span>(a2.2, a2, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ lfClass
## Model 2: aphidLH ~ lfClass + date
##   Resid. Df Resid. Dev Df Deviance    F  Pr(>F)    
## 1       332        435                             
## 2       328        412  4     22.3 5.47 0.00028 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">a1 &lt;- <span class="functioncall">glm</span>(aphidLH ~ lfClass, family = quasibinomial, data = ss)
null &lt;- <span class="functioncall">glm</span>(aphidLH ~ 1, family = quasibinomial, data = ss)
<span class="functioncall">anova</span>(null, a1, a2, a3, a4, a5, a6, test = <span class="string">"F"</span>)
</pre></div><div class="output"><pre class="knitr r">## Analysis of Deviance Table
## 
## Model 1: aphidLH ~ 1
## Model 2: aphidLH ~ lfClass
## Model 3: aphidLH ~ lfClass + date
## Model 4: aphidLH ~ lfClass + row + date
## Model 5: aphidLH ~ siteOfOriginPedigree + lfClass + row + date
## Model 6: aphidLH ~ siteOfOriginPedigree + lfClass + row + pos + date
## Model 7: aphidLH ~ siteOfOriginPedigree:lfClass + siteOfOriginPedigree + 
##     lfClass + row + pos + date
##   Resid. Df Resid. Dev Df Deviance     F  Pr(>F)    
## 1       333        461                              
## 2       332        435  1    26.08 24.96 9.9e-07 ***
## 3       328        412  4    22.28  5.33 0.00037 ***
## 4       327        404  1     8.69  8.32 0.00421 ** 
## 5       316        382 11    21.96  1.91 0.03752 *  
## 6       315        381  1     0.50  0.48 0.48832    
## 7       304        366 11    15.33  1.33 0.20456    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
</pre></div><div class="source"><pre class="knitr r">
<span class="comment"># evaluate best model:</span>
best &lt;- <span class="functioncall">glm</span>(aphidLH ~ siteOfOriginPedigree + lfClass + row + date, family = quasibinomial, 
    data = ss)
<span class="functioncall">summary</span>(best)
</pre></div><div class="output"><pre class="knitr r">## 
## Call:
## glm(formula = aphidLH ~ siteOfOriginPedigree + lfClass + row + 
##     date, family = quasibinomial, data = ss)
## 
## Deviance Residuals: 
##    Min      1Q  Median      3Q     Max  
## -1.995  -0.956  -0.465   0.958   2.223  
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(>|t|)    
## (Intercept)                 2.1662     1.0453    2.07   0.0390 *  
## siteOfOriginPedigreeri     -2.5449     1.1131   -2.29   0.0229 *  
## siteOfOriginPedigreekj     -1.2369     1.0152   -1.22   0.2240    
## siteOfOriginPedigreeaa     -2.0809     1.0393   -2.00   0.0461 *  
## siteOfOriginPedigreemapp   -2.7857     1.0515   -2.65   0.0085 ** 
## siteOfOriginPedigreealf    -0.3427     1.0099   -0.34   0.7346    
## siteOfOriginPedigreetower  -1.6096     0.9698   -1.66   0.0980 .  
## siteOfOriginPedigreenwlf   -1.6279     0.9735   -1.67   0.0955 .  
## siteOfOriginPedigreelc     -2.3880     0.9769   -2.44   0.0151 *  
## siteOfOriginPedigreeness   -1.1054     0.9171   -1.21   0.2290    
## siteOfOriginPedigreelf     -1.5477     0.9047   -1.71   0.0881 .  
## siteOfOriginPedigreespp    -1.6132     0.8776   -1.84   0.0670 .  
## lfClass>4                   1.4006     0.2753    5.09  6.2e-07 ***
## row                        -0.0499     0.0206   -2.42   0.0160 *  
## date2005-08-12             -0.4557     0.3882   -1.17   0.2413    
## date2005-08-14              0.5781     0.3736    1.55   0.1228    
## date2005-08-17             -0.9131     0.4090   -2.23   0.0263 *  
## date2005-08-19             -1.6604     0.6302   -2.63   0.0088 ** 
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 
## 
## (Dispersion parameter for quasibinomial family taken to be 1.046)
## 
##     Null deviance: 460.67  on 333  degrees of freedom
## Residual deviance: 381.66  on 316  degrees of freedom
## AIC: NA
## 
## Number of Fisher Scoring iterations: 4
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(2, 2))
<span class="functioncall">plot</span>(best)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-18.png" title="plot of chunk unnamed-chunk-18" alt="plot of chunk unnamed-chunk-18" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 1))

<span class="comment"># predict values based on typical individual, across all populations</span>
<span class="comment"># (modal measure date and size, median location)</span>
<span class="functioncall">table</span>(ss$lfClass)
</pre></div><div class="output"><pre class="knitr r">## 
## 1-4  >4 
## 155 179
</pre></div><div class="source"><pre class="knitr r"><span class="functioncall">table</span>(ss$date)
</pre></div><div class="output"><pre class="knitr r">## 
## 2005-08-11 2005-08-12 2005-08-14 2005-08-17 2005-08-19 
##         70         85         88         67         24
</pre></div><div class="source"><pre class="knitr r">sites &lt;- <span class="functioncall">levels</span>(ss$siteOfOriginPedigree)
newd &lt;- <span class="functioncall">data.frame</span>(siteOfOriginPedigree = sites, lfClass = <span class="string">"&gt;4"</span>, date = <span class="string">"2005-08-14"</span>, 
    row = <span class="functioncall">median</span>(ss$row))
pred &lt;- <span class="functioncall">predict</span>(best, type = <span class="string">"response"</span>, newdata = newd, se.fit = T)
newd$fit &lt;- pred$fit
newd$se &lt;- pred$se.fit

obs &lt;- <span class="functioncall">tapply</span>(ss$aphidLH, ss$siteOfOriginPedigree, mean)
<span class="comment"># compare predicted to observed values:</span>
</pre></div></div></div>


<div class="chunk" id="unnamed-chunk-19"><div class="rcode"><div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 2))
bp &lt;- <span class="functioncall">barplot</span>(newd$fit, ylim = <span class="functioncall">c</span>(0, 1), ylab = <span class="string">"prop of plants with &gt;10 <span class="functioncall">aphids</span> (fitted)"</span>)
<span class="functioncall">segments</span>(bp, newd$fit + newd$se, bp, newd$fit - newd$se)
<span class="functioncall">text</span>(bp, 0.03, labels = sites)
<span class="functioncall">text</span>(bp, 0.1, labels = <span class="functioncall">table</span>(ss$siteOfOriginPedigree))
bp &lt;- <span class="functioncall">barplot</span>(obs, ylim = <span class="functioncall">c</span>(0, 1), ylab = <span class="string">"prop of plants with &gt;10 <span class="functioncall">aphids</span> (obs.)"</span>)
<span class="functioncall">text</span>(bp, 0.03, labels = sites)
<span class="functioncall">text</span>(bp, 0.1, labels = <span class="functioncall">table</span>(ss$siteOfOriginPedigree))
<span class="functioncall">legend</span>(<span class="string">"topright"</span>, legend = <span class="string">"1997 garden, 2005"</span>)
</pre></div></div><div class="rimage default"><img src="figure/unnamed-chunk-19.png" title="plot of chunk unnamed-chunk-19" alt="plot of chunk unnamed-chunk-19" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="functioncall">par</span>(mfcol = <span class="functioncall">c</span>(1, 1))
</pre></div></div></div>



</body>
</html>
